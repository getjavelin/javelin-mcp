![oauth2_security_pattern_complete_responsibility_segregation](https://github.com/user-attachments/assets/feca8eab-9005-422f-bbc8-40a5e2921fee)# Solving the Agent Identity Problem in OAuth/OIDC Systems

## Executive Summary

Identity standards such as OpenID Connect (OIDC) and OAuth 2.0 provide robust mechanisms for
authentication and authorization in traditional user-centric scenarios. However, the emergence
of agentic systems has revealed critical gaps in these protocols when AI agents need to access
user data.

This document presents a comprehensive but high level solution to address the unique challenges of
agent identity management, building upon the security considerations outlined in the [Model
Context Protocol (MCP) Security Best Practices Specification](https://modelcontextprotocol.io/specification/2025-06-18/basic/security_best_practices).

## Problem Statement

### Functional Requirements

The introduction of AI agents into existing identity workflows creates two fundamental requirements:

1. **Agent to Client Relationship**: Agents must never operate autonomously. Every agent action
must be traceable to a human supervisor who explicitly instructed the agent to perform
specific tasks under defined circumstances. This establishes a clear chain of responsibility
for all agent-initiated activities through the declaration of relationships between agents
and clients.
2. **Agent to User Relationship**: When agents require access to user data, explicit consent
must be obtained from the data owner. This consent must encompass both the agent's access
requirements and the identity of the human controller directing the agent's actions.

### Security Requirements

The MCP specification identifies three critical attack vectors that must be addressed:

1. **Confused Deputy Problem**: Attackers may exploit agents, mcp clients, and mcp servers as
intermediaries to gain unauthorized access to user data without proper authentication flows.
2. **Token Passthrough Vulnerabilities**: Improper token validation can allow unauthorized
parties to bypass security controls by presenting tokens not intended for specific services.
3. **Session Hijacking**: Malicious actors may intercept or manipulate session identifiers to
impersonate legitimate users or inject unauthorized commands into agent workflows.

## Solution Overview

### Overview

The solution implements a proxy layer architecture that enhances existing identity providers
without requiring modifications to established OAuth/OIDC implementations. This approach
provides immediate compatibility with major identity providers (Microsoft, Google, etc.) while
addressing agent-specific security requirements.

![Uploading oauth2_security_patte<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="6430px" preserveAspectRatio="none" style="width:3361px;height:6430px;background:#FFFFFF;" version="1.1" viewBox="0 0 3361 6430" width="3361px" zoomAndPan="magnify"><defs/><g><rect fill="#F0F8FF" height="6418.0723" style="stroke:#181818;stroke-width:0.5;" width="289.688" x="3" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44.4019" x="125.6431" y="18.5684">Device</text><rect fill="#F8F8FF" height="6418.0723" style="stroke:#181818;stroke-width:0.5;" width="475.748" x="618.1133" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="57.3066" x="827.334" y="18.5684">AI Client</text><rect fill="#F9F4FE" height="6418.0723" style="stroke:#181818;stroke-width:0.5;" width="101.7559" x="1276.9951" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="60.3599" x="1297.6931" y="18.5684">AI Server</text><rect fill="#F2F7F7" height="6418.0723" style="stroke:#181818;stroke-width:0.5;" width="676.4858" x="1609.4004" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="37.4448" x="1928.9209" y="18.5684">Proxy</text><rect fill="#F8F8F0" height="6418.0723" style="stroke:#181818;stroke-width:0.5;" width="141.2539" x="2420.0029" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98.4648" x="2441.3975" y="18.5684">Authentication</text><rect fill="#F7FAF7" height="6418.0723" style="stroke:#181818;stroke-width:0.5;" width="169.001" x="2621.9683" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="92.0156" x="2660.4609" y="18.5684">Authorization</text><rect fill="#E5E3F3" height="6418.0723" style="stroke:#181818;stroke-width:0.5;" width="103.458" x="2878.9956" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="30.8623" x="2915.2935" y="18.5684">Data</text><rect fill="#F6FBFF" height="6418.0723" style="stroke:#181818;stroke-width:0.5;" width="52.9883" x="3121.1904" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="26.9204" x="3134.2244" y="18.5684">LLM</text><rect fill="none" height="328.75" style="stroke:#000000;stroke-width:1.5;" width="1193.5688" x="1603.4004" y="1190.7988"/><rect fill="none" height="277.3711" style="stroke:#000000;stroke-width:1.5;" width="2586.1143" x="210.855" y="2727.2773"/><rect fill="none" height="210.75" style="stroke:#000000;stroke-width:1.5;" width="2586.1143" x="210.855" y="3097.959"/><rect fill="none" height="216.1289" style="stroke:#000000;stroke-width:1.5;" width="2586.1143" x="210.855" y="3402.0195"/><rect fill="none" height="466.5449" style="stroke:#000000;stroke-width:1.5;" width="844.8188" x="2072.4888" y="3788.5234"/><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="6324.7852" width="8" x="25.1826" y="60.7988"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="29" x2="29" y1="60.7988" y2="6385.584"/></g><g><title>Browser</title><rect fill="#000000" fill-opacity="0.00000" height="6324.7852" width="8" x="250.7715" y="60.7988"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="253.855" x2="253.855" y1="60.7988" y2="6385.584"/></g><g><title>Agent</title><rect fill="#000000" fill-opacity="0.00000" height="6324.7852" width="8" x="645.1699" y="60.7988"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="649.1133" x2="649.1133" y1="60.7988" y2="6385.584"/></g><g><title>MCP Client</title><rect fill="#000000" fill-opacity="0.00000" height="6324.7852" width="8" x="1040.1523" y="60.7988"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1043.4434" x2="1043.4434" y1="60.7988" y2="6385.584"/></g><g><title>MCP Server</title><rect fill="#000000" fill-opacity="0.00000" height="6324.7852" width="8" x="1323.873" y="60.7988"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1326.9951" x2="1326.9951" y1="60.7988" y2="6385.584"/></g><g><title>Gateway</title><rect fill="#000000" fill-opacity="0.00000" height="6324.7852" width="8" x="1644.7593" y="60.7988"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1648.4004" x2="1648.4004" y1="60.7988" y2="6385.584"/></g><g><title>Proxy Open ID Provider</title><rect fill="#000000" fill-opacity="0.00000" height="6324.7852" width="8" x="1982.6636" y="60.7988"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1985.8384" x2="1985.8384" y1="60.7988" y2="6385.584"/></g><g><title>Proxy OAuth2 Authz Server</title><rect fill="#000000" fill-opacity="0.00000" height="6324.7852" width="8" x="2178.1875" y="60.7988"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2181.4888" x2="2181.4888" y1="60.7988" y2="6385.584"/></g><g><title>Open ID Provider</title><rect fill="#000000" fill-opacity="0.00000" height="6324.7852" width="8" x="2486.6299" y="60.7988"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2490.0029" x2="2490.0029" y1="60.7988" y2="6385.584"/></g><g><title>OAuth2 Authz Server</title><rect fill="#000000" fill-opacity="0.00000" height="6324.7852" width="8" x="2702.4688" y="60.7988"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2705.9683" x2="2705.9683" y1="60.7988" y2="6385.584"/></g><g><title>Data Server</title><rect fill="#000000" fill-opacity="0.00000" height="6324.7852" width="8" x="2926.7246" y="60.7988"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2929.9956" x2="2929.9956" y1="60.7988" y2="6385.584"/></g><g><title>LLM</title><rect fill="#000000" fill-opacity="0.00000" height="6324.7852" width="8" x="3143.6846" y="60.7988"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="3147.1904" x2="3147.1904" y1="60.7988" y2="6385.584"/></g><g class="participant participant-head" data-participant="User"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="44.3652" x="7" y="29.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.3652" x="14" y="49.8457">User</text></g><g class="participant participant-tail" data-participant="User"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="44.3652" x="7" y="6384.584"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30.3652" x="14" y="6405.1191">User</text></g><g class="participant participant-head" data-participant="Browser"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="67.833" x="220.855" y="29.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.833" x="227.855" y="49.8457">Browser</text></g><g class="participant participant-tail" data-participant="Browser"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="67.833" x="220.855" y="6384.584"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53.833" x="227.855" y="6405.1191">Browser</text></g><g class="participant participant-head" data-participant="Agent"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.1133" x="622.1133" y="29.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.1133" x="629.1133" y="49.8457">Agent</text></g><g class="participant participant-tail" data-participant="Agent"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54.1133" x="622.1133" y="6384.584"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40.1133" x="629.1133" y="6405.1191">Agent</text></g><g class="participant participant-head" data-participant="MCPClient"><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="87.418" x="1002.4434" y="25.3105"/><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="87.418" x="998.4434" y="29.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.418" x="1005.4434" y="49.8457">MCP Client</text></g><g class="participant participant-tail" data-participant="MCPClient"><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="87.418" x="1002.4434" y="6384.584"/><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="87.418" x="998.4434" y="6388.584"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="73.418" x="1005.4434" y="6409.1191">MCP Client</text></g><g class="participant participant-head" data-participant="MCPServer"><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="89.7559" x="1284.9951" y="25.3105"/><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="89.7559" x="1280.9951" y="29.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.7559" x="1287.9951" y="49.8457">MCP Server</text></g><g class="participant participant-tail" data-participant="MCPServer"><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="89.7559" x="1284.9951" y="6384.584"/><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="89.7559" x="1280.9951" y="6388.584"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75.7559" x="1287.9951" y="6409.1191">MCP Server</text></g><g class="participant participant-head" data-participant="Gtw"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="70.7178" x="1613.4004" y="29.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.7178" x="1620.4004" y="49.8457">Gateway</text></g><g class="participant participant-tail" data-participant="Gtw"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="70.7178" x="1613.4004" y="6384.584"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.7178" x="1620.4004" y="6405.1191">Gateway</text></g><g class="participant participant-head" data-participant="ProxyIdP"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="171.6504" x="1900.8384" y="29.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.6504" x="1907.8384" y="49.8457">Proxy Open ID Provider</text></g><g class="participant participant-tail" data-participant="ProxyIdP"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="171.6504" x="1900.8384" y="6384.584"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157.6504" x="1907.8384" y="6405.1191">Proxy Open ID Provider</text></g><g class="participant participant-head" data-participant="ProxyAuthzServer"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="199.3975" x="2082.4888" y="29.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185.3975" x="2089.4888" y="49.8457">Proxy OAuth2 Authz Server</text></g><g class="participant participant-tail" data-participant="ProxyAuthzServer"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="199.3975" x="2082.4888" y="6384.584"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185.3975" x="2089.4888" y="6405.1191">Proxy OAuth2 Authz Server</text></g><g class="participant participant-head" data-participant="IdP"><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="129.2539" x="2428.0029" y="25.3105"/><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="129.2539" x="2424.0029" y="29.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.2539" x="2431.0029" y="49.8457">Open ID Provider</text></g><g class="participant participant-tail" data-participant="IdP"><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="129.2539" x="2428.0029" y="6384.584"/><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="129.2539" x="2424.0029" y="6388.584"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.2539" x="2431.0029" y="6409.1191">Open ID Provider</text></g><g class="participant participant-head" data-participant="AuthzServer"><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="157.001" x="2629.9683" y="25.3105"/><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="157.001" x="2625.9683" y="29.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143.001" x="2632.9683" y="49.8457">OAuth2 Authz Server</text></g><g class="participant participant-tail" data-participant="AuthzServer"><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="157.001" x="2629.9683" y="6384.584"/><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="157.001" x="2625.9683" y="6388.584"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143.001" x="2632.9683" y="6409.1191">OAuth2 Authz Server</text></g><g class="participant participant-head" data-participant="DataServer"><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="91.458" x="2886.9956" y="25.3105"/><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="91.458" x="2882.9956" y="29.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.458" x="2889.9956" y="49.8457">Data Server</text></g><g class="participant participant-tail" data-participant="DataServer"><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="91.458" x="2886.9956" y="6384.584"/><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="91.458" x="2882.9956" y="6388.584"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.458" x="2889.9956" y="6409.1191">Data Server</text></g><g class="participant participant-head" data-participant="LLM"><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="40.9883" x="3129.1904" y="25.3105"/><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="40.9883" x="3125.1904" y="29.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26.9883" x="3132.1904" y="49.8457">LLM</text></g><g class="participant participant-tail" data-participant="LLM"><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="40.9883" x="3129.1904" y="6384.584"/><rect fill="#E2E2F0" height="30.4883" style="stroke:#181818;stroke-width:0.5;" width="40.9883" x="3125.1904" y="6388.584"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26.9883" x="3132.1904" y="6409.1191">LLM</text></g><rect fill="#D0D0D0" height="3" style="stroke:#D0D0D0;stroke-width:1;" width="3354.5073" x="0" y="120.5762"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="120.5762" y2="120.5762"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="123.5762" y2="123.5762"/><rect fill="#D0D0D0" height="31.5547" style="stroke:#696969;stroke-width:1;" width="433.7949" x="1460.3562" y="105.7988"/><text fill="#696969" font-family="sans-serif" font-size="20" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="248.4082" x="1552.0496" y="129.1348">OAuth2 Security Pattern</text><rect fill="#E9E9E9" height="3" style="stroke:#E9E9E9;stroke-width:1;" width="3354.5073" x="0" y="168.5977"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="168.5977" y2="168.5977"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="171.5977" y2="171.5977"/><rect fill="#E9E9E9" height="24.4883" style="stroke:#696969;stroke-width:1;" width="1257.4775" x="1048.5149" y="157.3535"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="1123.5068" x="1114.5002" y="174.8887">Multiple Entities with Access to User Data, accomplished through Independent Entities carrying out Proxy Authn, Proxy Authz, Authn, Authz and Data Mgmt</text><path d="M5,246.8418 L5,485.8418 L504,485.8418 L504,256.8418 L494,246.8418 L5,246.8418" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M494,246.8418 L494,256.8418 L504,256.8418 L494,246.8418" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="82.1069" x="11" y="264.4102">Diagram Info</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="11" y="279.7207">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="60.4233" x="11" y="295.0313">PURPOSE</text><ellipse cx="16.5" cy="305.584" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181.543" x="23" y="310.3418">Security View when there are</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287.0093" x="27.4531" y="325.6523">- Multiple Entities requiring User Data Access</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266.7095" x="27.4531" y="340.9629">- Participating Entities are all Independent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="11" y="356.2734">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="110.3604" x="11" y="371.584">PRE-REQUISITES</text><ellipse cx="16.5" cy="382.1367" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239.2876" x="23" y="386.8945">Agent registered to LLM as LLM Client</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.979" x="27.4531" y="402.2051">* Agent has api_key</text><ellipse cx="16.5" cy="412.7578" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="466.8955" x="23" y="417.5156">MCP Server registered to Proxy IdP/Authz Server as a Proxy OAuth2 Client</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359.5693" x="27.4531" y="432.8262">* MCP Server has proxy_client_id and proxy_client_secret</text><ellipse cx="16.5" cy="443.3789" fill="#000000" rx="2.5" ry="2.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="426.2769" x="23" y="448.1367">Proxy Authz Server registered to IdP/Authz Server as OAuth2 Client</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="289.6689" x="27.4531" y="463.4473">Proxy Authz Server has client_id, client_secret</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="11" y="478.7578">&#160;</text><g class="message" data-participant-1="Browser" data-participant-2="Agent"><polygon fill="#181818" points="637.1699,549.1211,647.1699,553.1211,637.1699,557.1211,641.1699,553.1211" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="643.1699" y1="553.1211" y2="553.1211"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="261.7715" y="533.0684">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.0742" x="274.4604" y="533.0684">Establish Server</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.6069" x="294.6777" y="548.3789">Sent Event Connection ()</text></g><g class="message" data-participant-1="Agent" data-participant-2="Browser"><polygon fill="#181818" points="265.7715,578.4316,255.7715,582.4316,265.7715,586.4316,261.7715,582.4316" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="259.7715" x2="648.1699" y1="582.4316" y2="582.4316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="47.3599" x="271.7715" y="577.6895">200 OK</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="3354.5073" x="0" y="610.498"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="610.498" y2="610.498"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="613.498" y2="613.498"/><rect fill="#FFFFFF" height="22.1328" style="stroke:#696969;stroke-width:1;" width="224.5918" x="1564.9578" y="600.4316"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="107.7598" x="1622.3738" y="616.0332">React to Stimulus</text><g class="message" data-participant-1="User" data-participant-2="Browser"><polygon fill="#181818" points="242.7715,649.875,252.7715,653.875,242.7715,657.875,246.7715,653.875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="29.1826" x2="248.7715" y1="653.875" y2="653.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="36.1826" y="649.1328">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.3169" x="48.8716" y="649.1328">Interaction ()</text></g><g class="message" data-participant-1="Browser" data-participant-2="Agent"><polygon fill="#181818" points="637.1699,679.1855,647.1699,683.1855,637.1699,687.1855,641.1699,683.1855" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="643.1699" y1="683.1855" y2="683.1855"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="261.7715" y="678.4434">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46.5156" x="274.4604" y="678.4434">Event ()</text></g><g class="message" data-participant-1="Agent" data-participant-2="Browser"><polygon fill="#181818" points="265.7715,693.1855,255.7715,697.1855,265.7715,701.1855,261.7715,697.1855" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="259.7715" x2="648.1699" y1="697.1855" y2="697.1855"/></g><g class="message" data-participant-1="Agent" data-participant-2="MCPClient"><polygon fill="#181818" points="1032.1523,722.4961,1042.1523,726.4961,1032.1523,730.4961,1036.1523,726.4961" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.1699" x2="1038.1523" y1="726.4961" y2="726.4961"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="656.1699" y="721.7539">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.2749" x="668.8589" y="721.7539">Perform Task ()</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="3354.5073" x="0" y="754.5625"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="754.5625" y2="754.5625"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="757.5625" y2="757.5625"/><rect fill="#FFFFFF" height="22.1328" style="stroke:#696969;stroke-width:1;" width="238.2266" x="1558.1404" y="744.4961"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="121.3945" x="1615.5564" y="760.0977">Access Private Data</text><polygon fill="#E0E0E0" points="1059,781.6289,1253,781.6289,1263,792.6289,1253,804.6289,1059,804.6289,1049,792.6289,1059,781.6289" style="stroke:#181818;stroke-width:0.5;"/><a href="https://modelcontextprotocol.io/specification/2025-03-26/basic/authorization" target="_top" title="https://modelcontextprotocol.io/specification/2025-03-26/basic/authorization" xlink:actuate="onRequest" xlink:href="https://modelcontextprotocol.io/specification/2025-03-26/basic/authorization" xlink:show="new" xlink:title="https://modelcontextprotocol.io/specification/2025-03-26/basic/authorization" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="102.1084" x="1061" y="798.1973">MCP Authz Spec</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1163.1084" y="798.1973">,</text><a href="https://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/schema/2025-03-26/schema.ts" target="_top" title="https://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/schema/2025-03-26/schema.ts" xlink:actuate="onRequest" xlink:href="https://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/schema/2025-03-26/schema.ts" xlink:show="new" xlink:title="https://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/schema/2025-03-26/schema.ts" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="79.7773" x="1171.335" y="798.1973">MCP Schema</text></a><g class="message" data-participant-1="MCPClient" data-participant-2="MCPServer"><polygon fill="#181818" points="1315.873,827.25,1325.873,831.25,1315.873,835.25,1319.873,831.25" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1044.1523" x2="1321.873" y1="831.25" y2="831.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="1051.1523" y="826.5078">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66.1489" x="1063.8413" y="826.5078">Initialize ()</text></g><g class="message" data-participant-1="MCPClient" data-participant-2="MCPServer"><polygon fill="#181818" points="1315.873,856.5605,1325.873,860.5605,1315.873,864.5605,1319.873,860.5605" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1044.1523" x2="1321.873" y1="860.5605" y2="860.5605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="1051.1523" y="855.8184">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73.436" x="1063.8413" y="855.8184">List Tools ()</text></g><g class="message" data-participant-1="MCPClient" data-participant-2="MCPServer"><polygon fill="#181818" points="1315.873,885.8711,1325.873,889.8711,1315.873,893.8711,1319.873,889.8711" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1044.1523" x2="1321.873" y1="889.8711" y2="889.8711"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="1051.1523" y="885.1289">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.3198" x="1063.8413" y="885.1289">Call Tool ()</text></g><g class="message" data-participant-1="MCPServer" data-participant-2="Gtw"><polygon fill="#181818" points="1636.7593,915.1816,1646.7593,919.1816,1636.7593,923.1816,1640.7593,919.1816" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1327.873" x2="1642.7593" y1="919.1816" y2="919.1816"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20.3633" x="1334.873" y="914.4395">8.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.3569" x="1359.3496" y="914.4395">Retrieve Context Data ()</text></g><g class="message" data-participant-1="Gtw" data-participant-2="DataServer"><polygon fill="#181818" points="2918.7246,944.4922,2928.7246,948.4922,2918.7246,952.4922,2922.7246,948.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="2924.7246" y1="948.4922" y2="948.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20.3633" x="1655.7593" y="943.75">8.2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.3569" x="1680.2358" y="943.75">Retrieve Context Data ()</text></g><polygon fill="#E0E0E0" points="1663,961.4922,1728,961.4922,1738,972.4922,1728,984.4922,1663,984.4922,1653,972.4922,1663,961.4922" style="stroke:#181818;stroke-width:0.5;"/><a href="https://datatracker.ietf.org/doc/html/rfc9728" target="_top" title="https://datatracker.ietf.org/doc/html/rfc9728" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc9728" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc9728" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="1665" y="978.0605">RFC 9728</text></a><g class="message" data-participant-1="DataServer" data-participant-2="Gtw"><polygon fill="#181818" points="1659.7593,1037.7344,1649.7593,1041.7344,1659.7593,1045.7344,1655.7593,1041.7344" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1653.7593" x2="2929.7246" y1="1041.7344" y2="1041.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="290.9258" x="1665.7593" y="1006.3711">401 Unauthorized, WWW-Authenticate: Bearer</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="288.9199" x="1698.6655" y="1021.6816">resource_metadata="https://dataserver.com/</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="256.0264" x="1731.5718" y="1036.9922">.well-known/oauth-protected-resource"</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="3354.5073" x="0" y="1069.8008"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="1069.8008" y2="1069.8008"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="1072.8008" y2="1072.8008"/><rect fill="#FFFFFF" height="22.1328" style="stroke:#696969;stroke-width:1;" width="315.9688" x="1519.2693" y="1059.7344"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="199.1367" x="1576.6853" y="1075.3359">Find out Authorization Endpoint</text><polygon fill="#E0E0E0" points="1663,1096.8672,1728,1096.8672,1738,1107.8672,1728,1119.8672,1663,1119.8672,1653,1107.8672,1663,1096.8672" style="stroke:#181818;stroke-width:0.5;"/><a href="https://datatracker.ietf.org/doc/html/rfc9728" target="_top" title="https://datatracker.ietf.org/doc/html/rfc9728" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc9728" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc9728" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="1665" y="1113.4355">RFC 9728</text></a><g class="message" data-participant-1="Gtw" data-participant-2="DataServer"><polygon fill="#181818" points="2918.7246,1142.4883,2928.7246,1146.4883,2918.7246,1150.4883,2922.7246,1146.4883" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="2924.7246" y1="1146.4883" y2="1146.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="1655.7593" y="1141.7461">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.5425" x="1668.4482" y="1141.7461">Get Resource Metadata ()</text></g><g class="message" data-participant-1="DataServer" data-participant-2="Gtw"><polygon fill="#181818" points="1659.7593,1171.7988,1649.7593,1175.7988,1659.7593,1179.7988,1655.7593,1175.7988" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1653.7593" x2="2929.7246" y1="1175.7988" y2="1175.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="198.8403" x="1665.7593" y="1171.0566">resource, authorization_servers</text></g><path d="M1603.4004,1190.7988 L1665.5391,1190.7988 L1665.5391,1198.1094 L1655.5391,1208.1094 L1603.4004,1208.1094 L1603.4004,1190.7988" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="328.75" style="stroke:#000000;stroke-width:1.5;" width="1193.5688" x="1603.4004" y="1190.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="1618.4004" y="1204.3672">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="37.415" x="1680.5391" y="1203.4336">[OIDC]</text><polygon fill="#E0E0E0" points="1663,1213.1094,1764,1213.1094,1774,1224.1094,1764,1236.1094,1663,1236.1094,1653,1224.1094,1663,1213.1094" style="stroke:#181818;stroke-width:0.5;"/><a href="https://openid.net/specs/openid-connect-discovery-1_0.html" target="_top" title="https://openid.net/specs/openid-connect-discovery-1_0.html" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-connect-discovery-1_0.html" xlink:show="new" xlink:title="https://openid.net/specs/openid-connect-discovery-1_0.html" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="97.5381" x="1665" y="1229.6777">OIDC Discovery</text></a><g class="message" data-participant-1="Gtw" data-participant-2="ProxyAuthzServer"><polygon fill="#181818" points="2170.1875,1258.7305,2180.1875,1262.7305,2170.1875,1266.7305,2174.1875,1262.7305" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="2176.1875" y1="1262.7305" y2="1262.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="1655.7593" y="1257.9883">10.1.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.2139" x="1700.5991" y="1257.9883">Download OIDC Configuration ()</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="IdP"><polygon fill="#181818" points="2478.6299,1288.041,2488.6299,1292.041,2478.6299,1296.041,2482.6299,1292.041" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="2182.1875" x2="2484.6299" y1="1292.041" y2="1292.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="2189.1875" y="1287.2988">10.1.2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.2139" x="2234.0273" y="1287.2988">Download OIDC Configuration ()</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="ProxyAuthzServer"><line style="stroke:#181818;stroke-width:1;" x1="2182.1875" x2="2224.1875" y1="1321.3516" y2="1321.3516"/><line style="stroke:#181818;stroke-width:1;" x1="2224.1875" x2="2224.1875" y1="1321.3516" y2="1334.3516"/><line style="stroke:#181818;stroke-width:1;" x1="2183.1875" x2="2224.1875" y1="1334.3516" y2="1334.3516"/><polygon fill="#181818" points="2193.1875,1330.3516,2183.1875,1334.3516,2193.1875,1338.3516,2189.1875,1334.3516" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="2189.1875" y="1316.6094">10.1.3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.0371" x="2234.0273" y="1316.6094">Persist OIDC Configuration  ()</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="Gtw"><polygon fill="#181818" points="1659.7593,1344.3516,1649.7593,1348.3516,1659.7593,1352.3516,1655.7593,1348.3516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1653.7593" x2="2181.1875" y1="1348.3516" y2="1348.3516"/></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1603.4004" x2="2796.9692" y1="1357.3516" y2="1357.3516"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="51.4712" x="1608.4004" y="1367.9863">[OAuth2]</text><polygon fill="#E0E0E0" points="1663,1376.3066,1728,1376.3066,1738,1387.3066,1728,1399.3066,1663,1399.3066,1653,1387.3066,1663,1376.3066" style="stroke:#181818;stroke-width:0.5;"/><a href="https://datatracker.ietf.org/doc/html/rfc8414" target="_top" title="https://datatracker.ietf.org/doc/html/rfc8414" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc8414" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc8414" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="1665" y="1392.875">RFC 8414</text></a><g class="message" data-participant-1="Gtw" data-participant-2="ProxyAuthzServer"><polygon fill="#181818" points="2170.1875,1421.9277,2180.1875,1425.9277,2170.1875,1429.9277,2174.1875,1425.9277" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="2176.1875" y1="1425.9277" y2="1425.9277"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="1655.7593" y="1421.1855">10.2.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270.8926" x="1700.5991" y="1421.1855">Download Authorization Server Metadata ()</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="AuthzServer"><polygon fill="#181818" points="2694.4688,1451.2383,2704.4688,1455.2383,2694.4688,1459.2383,2698.4688,1455.2383" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="2182.1875" x2="2700.4688" y1="1455.2383" y2="1455.2383"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="2189.1875" y="1450.4961">10.2.2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229.4805" x="2234.0273" y="1450.4961">Get Authorization Server Metadata ()</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="ProxyAuthzServer"><line style="stroke:#181818;stroke-width:1;" x1="2182.1875" x2="2224.1875" y1="1484.5488" y2="1484.5488"/><line style="stroke:#181818;stroke-width:1;" x1="2224.1875" x2="2224.1875" y1="1484.5488" y2="1497.5488"/><line style="stroke:#181818;stroke-width:1;" x1="2183.1875" x2="2224.1875" y1="1497.5488" y2="1497.5488"/><polygon fill="#181818" points="2193.1875,1493.5488,2183.1875,1497.5488,2193.1875,1501.5488,2189.1875,1497.5488" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="2189.1875" y="1479.8066">10.2.3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249.6025" x="2234.0273" y="1479.8066">Persist Authorization Server Metadata ()</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="Gtw"><polygon fill="#181818" points="1659.7593,1507.5488,1649.7593,1511.5488,1659.7593,1515.5488,1655.7593,1511.5488" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1653.7593" x2="2181.1875" y1="1511.5488" y2="1511.5488"/></g><g class="message" data-participant-1="Gtw" data-participant-2="MCPServer"><polygon fill="#181818" points="1338.873,1559.1699,1328.873,1563.1699,1338.873,1567.1699,1334.873,1563.1699" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1332.873" x2="1647.7593" y1="1563.1699" y2="1563.1699"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="20.3633" x="1344.873" y="1543.1172">8.1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="247.0317" x="1369.3496" y="1543.1172">401 Unauthorized, WWW-Authenticate:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="143.9585" x="1377.7793" y="1558.4277">Bearer realm="oauth2"</text></g><g class="message" data-participant-1="MCPServer" data-participant-2="MCPClient"><polygon fill="#181818" points="1055.1523,1603.791,1045.1523,1607.791,1055.1523,1611.791,1051.1523,1607.791" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1049.1523" x2="1326.873" y1="1607.791" y2="1607.791"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="1061.1523" y="1587.7383">7</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="247.0317" x="1073.8413" y="1587.7383">401 Unauthorized, WWW-Authenticate,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="131.6885" x="1094.0586" y="1603.0488">error=access_denied</text></g><g class="message" data-participant-1="MCPClient" data-participant-2="Agent"><polygon fill="#181818" points="660.1699,1648.4121,650.1699,1652.4121,660.1699,1656.4121,656.1699,1652.4121" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="654.1699" x2="1043.1523" y1="1652.4121" y2="1652.4121"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="666.1699" y="1632.3594">4</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="247.0317" x="678.8589" y="1632.3594">401 Unauthorized, WWW-Authenticate,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="131.6885" x="699.0762" y="1647.6699">error=access_denied</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="3354.5073" x="0" y="1680.4785"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="1680.4785" y2="1680.4785"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="1683.4785" y2="1683.4785"/><rect fill="#FFFFFF" height="22.1328" style="stroke:#696969;stroke-width:1;" width="301.5547" x="1526.4763" y="1670.4121"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="184.7227" x="1583.8923" y="1686.0137">Authenticate and Get Consent</text><g class="message" data-participant-1="Agent" data-participant-2="MCPClient"><polygon fill="#181818" points="1032.1523,1719.8555,1042.1523,1723.8555,1032.1523,1727.8555,1036.1523,1723.8555" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.1699" x2="1038.1523" y1="1723.8555" y2="1723.8555"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="656.1699" y="1719.1133">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228.814" x="677.4346" y="1719.1133">Get Authorization Request Params ()</text></g><g class="message" data-participant-1="MCPClient" data-participant-2="MCPServer"><polygon fill="#181818" points="1315.873,1749.166,1325.873,1753.166,1315.873,1757.166,1319.873,1753.166" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1044.1523" x2="1321.873" y1="1753.166" y2="1753.166"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1051.1523" y="1748.4238">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228.814" x="1072.417" y="1748.4238">Get Authorization Request Params ()</text></g><g class="message" data-participant-1="MCPServer" data-participant-2="MCPServer"><line style="stroke:#181818;stroke-width:1;" x1="1327.873" x2="1369.873" y1="1797.7871" y2="1797.7871"/><line style="stroke:#181818;stroke-width:1;" x1="1369.873" x2="1369.873" y1="1797.7871" y2="1810.7871"/><line style="stroke:#181818;stroke-width:1;" x1="1328.873" x2="1369.873" y1="1810.7871" y2="1810.7871"/><polygon fill="#181818" points="1338.873,1806.7871,1328.873,1810.7871,1338.873,1814.7871,1334.873,1810.7871" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1334.873" y="1777.7344">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.647" x="1356.1377" y="1777.7344">Load Preferred Params ():</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="54.4629" x="1334.873" y="1793.0449">resource</text></g><polygon fill="#E0E0E0" points="1342,1823.7871,1407,1823.7871,1417,1834.7871,1407,1846.7871,1342,1846.7871,1332,1834.7871,1342,1823.7871" style="stroke:#181818;stroke-width:0.5;"/><a href="https://datatracker.ietf.org/doc/html/rfc8707" target="_top" title="https://datatracker.ietf.org/doc/html/rfc8707" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc8707" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc8707" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="1344" y="1840.3555">RFC 8707</text></a><g class="message" data-participant-1="MCPServer" data-participant-2="Gtw"><polygon fill="#181818" points="1636.7593,1884.7188,1646.7593,1888.7188,1636.7593,1892.7188,1640.7593,1888.7188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1327.873" x2="1642.7593" y1="1888.7188" y2="1888.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="1334.873" y="1868.666">14.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.3154" x="1367.9253" y="1868.666">Get Proxy Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.2163" x="1367.7793" y="1883.9766">Request Params (resource)</text></g><g class="message" data-participant-1="Gtw" data-participant-2="ProxyAuthzServer"><polygon fill="#181818" points="2170.1875,1929.3398,2180.1875,1933.3398,2170.1875,1937.3398,2174.1875,1933.3398" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="2176.1875" y1="1933.3398" y2="1933.3398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="1655.7593" y="1913.2871">14.2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.3154" x="1688.8115" y="1913.2871">Get Proxy Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.2163" x="1688.6655" y="1928.5977">Request Params (resource)</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="ProxyAuthzServer"><line style="stroke:#181818;stroke-width:1;" x1="2182.1875" x2="2224.1875" y1="1962.6504" y2="1962.6504"/><line style="stroke:#181818;stroke-width:1;" x1="2224.1875" x2="2224.1875" y1="1962.6504" y2="1975.6504"/><line style="stroke:#181818;stroke-width:1;" x1="2183.1875" x2="2224.1875" y1="1975.6504" y2="1975.6504"/><polygon fill="#181818" points="2193.1875,1971.6504,2183.1875,1975.6504,2193.1875,1979.6504,2189.1875,1975.6504" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="2189.1875" y="1957.9082">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.9487" x="2210.4521" y="1957.9082">Load Proxy OIDC Configuration ()</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="Gtw"><polygon fill="#181818" points="1659.7593,2000.9609,1649.7593,2004.9609,1659.7593,2008.9609,1655.7593,2004.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1653.7593" x2="2181.1875" y1="2004.9609" y2="2004.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="1665.7593" y="2000.2188">14.2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="210.7104" x="1698.8115" y="2000.2188">proxy_authorization_endpoint, ...</text></g><g class="message" data-participant-1="Gtw" data-participant-2="MCPServer"><polygon fill="#181818" points="1338.873,2030.2715,1328.873,2034.2715,1338.873,2038.2715,1334.873,2034.2715" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1332.873" x2="1647.7593" y1="2034.2715" y2="2034.2715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="1344.873" y="2029.5293">14.1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="210.7104" x="1377.9253" y="2029.5293">proxy_authorization_endpoint, ...</text></g><g class="message" data-participant-1="MCPServer" data-participant-2="MCPClient"><polygon fill="#181818" points="1055.1523,2059.582,1045.1523,2063.582,1055.1523,2067.582,1051.1523,2063.582" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1049.1523" x2="1326.873" y1="2063.582" y2="2063.582"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1061.1523" y="2058.8398">12</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="210.7104" x="1082.417" y="2058.8398">proxy_authorization_endpoint, ...</text></g><g class="message" data-participant-1="MCPClient" data-participant-2="Agent"><polygon fill="#181818" points="660.1699,2088.8926,650.1699,2092.8926,660.1699,2096.8926,656.1699,2092.8926" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="654.1699" x2="1043.1523" y1="2092.8926" y2="2092.8926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="666.1699" y="2088.1504">11</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="349.7178" x="687.4346" y="2088.1504">proxy_authorization_endpoint, mcpserver_metadata, ...</text></g><g class="message" data-participant-1="Agent" data-participant-2="Browser"><line style="stroke:#181818;stroke-width:1;" x1="255.7715" x2="265.7715" y1="2152.8242" y2="2148.8242"/><line style="stroke:#181818;stroke-width:1;" x1="255.7715" x2="265.7715" y1="2152.8242" y2="2156.8242"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="254.7715" x2="648.1699" y1="2152.8242" y2="2152.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="44.0972" x="271.7715" y="2117.4609">16 SSE</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="208.876" x="319.9819" y="2117.4609">Take User to Authentication Flow</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="337.4922" x="304.6777" y="2132.7715">(proxy_authorization_endpoint, mcpserver_metadata,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="260.4507" x="304.6777" y="2148.082">mcpclient_metadata, agent_metadata, ...)</text></g><g class="message" data-participant-1="Browser" data-participant-2="Gtw"><polygon fill="#181818" points="1636.7593,2224.0664,1646.7593,2228.0664,1636.7593,2232.0664,1640.7593,2228.0664" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="1642.7593" y1="2228.0664" y2="2228.0664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="261.7715" y="2177.3926">17.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.6567" x="294.8237" y="2177.3926">OIDC Authentication Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251.5068" x="294.6777" y="2192.7031">(proxy_client_id, proxy_code_challenge,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226.7065" x="294.6777" y="2208.0137">resource, scope, proxy_redirect_uri,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188.4937" x="294.6777" y="2223.3242">proxy_agent_id, metadata, ...)</text></g><g class="message" data-participant-1="Gtw" data-participant-2="ProxyIdP"><polygon fill="#181818" points="1974.6636,2253.377,1984.6636,2257.377,1974.6636,2261.377,1978.6636,2257.377" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="1980.6636" y1="2257.377" y2="2257.377"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="1655.7593" y="2252.6348">17.2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247.9331" x="1688.8115" y="2252.6348">Proxy OIDC Authentication Request (...)</text></g><g class="message" data-participant-1="ProxyIdP" data-participant-2="ProxyIdP"><line style="stroke:#181818;stroke-width:1;" x1="1986.6636" x2="2028.6636" y1="2301.998" y2="2301.998"/><line style="stroke:#181818;stroke-width:1;" x1="2028.6636" x2="2028.6636" y1="2301.998" y2="2314.998"/><line style="stroke:#181818;stroke-width:1;" x1="1987.6636" x2="2028.6636" y1="2314.998" y2="2314.998"/><polygon fill="#181818" points="1997.6636,2310.998,1987.6636,2314.998,1997.6636,2318.998,1993.6636,2314.998" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1993.6636" y="2281.9453">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.9575" x="2014.9282" y="2281.9453">Verify Agent-Client</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90.2764" x="2026.5698" y="2297.2559">Relationship ()</text></g><g class="message" data-participant-1="ProxyIdP" data-participant-2="Gtw"><polygon fill="#181818" points="1659.7593,2401.5508,1649.7593,2405.5508,1659.7593,2409.5508,1655.7593,2405.5508" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1653.7593" x2="1985.6636" y1="2405.5508" y2="2405.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="215.7188" x="1665.7593" y="2339.5664">html, js, css, ... Do you consent to</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="47.7217" x="1885.5913" y="2339.5664">{proxy}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="42.2373" x="1937.4263" y="2339.5664">and all</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="129.7842" x="1698.6655" y="2354.877">the following parties</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="102.6416" x="1832.563" y="2354.877">{parties=agent,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="184.6343" x="1698.6655" y="2370.1875">mcp client, mcp server, llm}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="41.9072" x="1887.4131" y="2370.1875">having</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="203.0425" x="1698.6655" y="2385.498">access to your data managed by</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="146.123" x="1698.6655" y="2400.8086">{authorization server}</text></g><g class="message" data-participant-1="Gtw" data-participant-2="Browser"><polygon fill="#181818" points="265.7715,2492.1035,255.7715,2496.1035,265.7715,2500.1035,261.7715,2496.1035" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="259.7715" x2="1647.7593" y1="2496.1035" y2="2496.1035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="271.7715" y="2430.1191">17.1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="215.7188" x="304.8237" y="2430.1191">html, js, css, ... Do you consent to</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="47.7217" x="524.6558" y="2430.1191">{proxy}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="42.2373" x="576.4907" y="2430.1191">and all</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="129.7842" x="304.6777" y="2445.4297">the following parties</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="102.6416" x="438.5752" y="2445.4297">{parties=agent,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="184.6343" x="304.6777" y="2460.7402">mcp client, mcp server, llm}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="41.9072" x="493.4253" y="2460.7402">having</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="203.0425" x="304.6777" y="2476.0508">access to your data managed by</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="146.123" x="304.6777" y="2491.3613">{authorization server}</text></g><g class="message" data-participant-1="User" data-participant-2="Browser"><polygon fill="#181818" points="242.7715,2521.4141,252.7715,2525.4141,242.7715,2529.4141,246.7715,2525.4141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="29.1826" x2="248.7715" y1="2525.4141" y2="2525.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="36.1826" y="2520.6719">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.061" x="57.4473" y="2520.6719">Consent to Data Sharing ()</text></g><g class="message" data-participant-1="Browser" data-participant-2="User"><polygon fill="#181818" points="40.1826,2535.4141,30.1826,2539.4141,40.1826,2543.4141,36.1826,2539.4141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="34.1826" x2="253.7715" y1="2539.4141" y2="2539.4141"/></g><g class="message" data-participant-1="Browser" data-participant-2="Gtw"><polygon fill="#181818" points="1636.7593,2564.7246,1646.7593,2568.7246,1636.7593,2572.7246,1640.7593,2568.7246" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="1642.7593" y1="2568.7246" y2="2568.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="261.7715" y="2563.9824">20.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.9404" x="294.8237" y="2563.9824">Store Consent ()</text></g><g class="message" data-participant-1="Gtw" data-participant-2="ProxyAuthzServer"><polygon fill="#181818" points="2170.1875,2594.0352,2180.1875,2598.0352,2170.1875,2602.0352,2174.1875,2598.0352" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="2176.1875" y1="2598.0352" y2="2598.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="1655.7593" y="2593.293">20.2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.9404" x="1688.8115" y="2593.293">Store Consent ()</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="Gtw"><polygon fill="#181818" points="1659.7593,2638.6563,1649.7593,2642.6563,1659.7593,2646.6563,1655.7593,2642.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1653.7593" x2="2181.1875" y1="2642.6563" y2="2642.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="133.8149" x="1665.7593" y="2622.6035">302 Found, Location:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="289.5864" x="1698.6655" y="2637.9141">{authorization_server}?{authorization_params}</text></g><g class="message" data-participant-1="Gtw" data-participant-2="Browser"><polygon fill="#181818" points="265.7715,2683.2773,255.7715,2687.2773,265.7715,2691.2773,261.7715,2687.2773" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="259.7715" x2="1647.7593" y1="2687.2773" y2="2687.2773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="133.8149" x="271.7715" y="2667.2246">302 Found, Location:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="289.5864" x="304.6777" y="2682.5352">{authorization_server}?{authorization_params}</text></g><path d="M210.855,2727.2773 L272.9937,2727.2773 L272.9937,2734.5879 L262.9937,2744.5879 L210.855,2744.5879 L210.855,2727.2773" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="277.3711" style="stroke:#000000;stroke-width:1.5;" width="2586.1143" x="210.855" y="2727.2773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="225.855" y="2740.8457">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="37.415" x="287.9937" y="2739.9121">[OIDC]</text><polygon fill="#E0E0E0" points="269,2749.5879,408,2749.5879,418,2760.5879,408,2772.5879,269,2772.5879,259,2760.5879,269,2749.5879" style="stroke:#181818;stroke-width:0.5;"/><a href="https://openid.net/specs/openid-connect-core-1_0.html" target="_top" title="https://openid.net/specs/openid-connect-core-1_0.html" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-connect-core-1_0.html" xlink:show="new" xlink:title="https://openid.net/specs/openid-connect-core-1_0.html" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="66.2314" x="271" y="2766.1563">OIDC Core</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="337.2314" y="2766.1563">,</text><a href="https://datatracker.ietf.org/doc/html/rfc7636" target="_top" title="https://datatracker.ietf.org/doc/html/rfc7636" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc7636" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc7636" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="345.458" y="2766.1563">RFC 7636</text></a><g class="message" data-participant-1="Browser" data-participant-2="IdP"><polygon fill="#181818" points="2478.6299,2825.8301,2488.6299,2829.8301,2478.6299,2833.8301,2482.6299,2829.8301" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="2484.6299" y1="2829.8301" y2="2829.8301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="261.7715" y="2794.4668">21.1.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.6567" x="306.6113" y="2794.4668">OIDC Authentication Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.0039" x="294.6777" y="2809.7773">(client_id, code_challenge,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.9463" x="294.6777" y="2825.0879">scope, redirect_uri, ...)</text></g><g class="message" data-participant-1="IdP" data-participant-2="Browser"><polygon fill="#181818" points="265.7715,2855.1406,255.7715,2859.1406,265.7715,2863.1406,261.7715,2859.1406" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="259.7715" x2="2489.6299" y1="2859.1406" y2="2859.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="96.3384" x="271.7715" y="2854.3984">html, js, css, ...</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="210.855" x2="2796.9692" y1="2868.1406" y2="2868.1406"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="51.4712" x="215.855" y="2878.7754">[OAuth2]</text><polygon fill="#E0E0E0" points="269,2887.0957,403,2887.0957,413,2898.0957,403,2910.0957,269,2910.0957,259,2898.0957,269,2887.0957" style="stroke:#181818;stroke-width:0.5;"/><a href="https://datatracker.ietf.org/doc/html/rfc6749" target="_top" title="https://datatracker.ietf.org/doc/html/rfc6749" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc6749" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc6749" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="271" y="2903.6641">RFC 6749</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="332.1787" y="2903.6641">,</text><a href="https://datatracker.ietf.org/doc/html/rfc7636" target="_top" title="https://datatracker.ietf.org/doc/html/rfc7636" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc7636" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc7636" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="340.4053" y="2903.6641">RFC 7636</text></a><g class="message" data-participant-1="Browser" data-participant-2="AuthzServer"><polygon fill="#181818" points="2694.4688,2963.3379,2704.4688,2967.3379,2694.4688,2971.3379,2698.4688,2967.3379" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="2700.4688" y1="2967.3379" y2="2967.3379"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="261.7715" y="2931.9746">21.2.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.2925" x="306.6113" y="2931.9746">OAuth2 Authorization Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.0039" x="294.6777" y="2947.2852">(client_id, code_challenge,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.9463" x="294.6777" y="2962.5957">scope, redirect_uri, ...)</text></g><g class="message" data-participant-1="AuthzServer" data-participant-2="Browser"><polygon fill="#181818" points="265.7715,2992.6484,255.7715,2996.6484,265.7715,3000.6484,261.7715,2996.6484" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="259.7715" x2="2705.4688" y1="2996.6484" y2="2996.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="96.3384" x="271.7715" y="2991.9063">html, js, css, ...</text></g><g class="message" data-participant-1="User" data-participant-2="Browser"><polygon fill="#181818" points="242.7715,3053.959,252.7715,3057.959,242.7715,3061.959,246.7715,3057.959" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="29.1826" x2="248.7715" y1="3057.959" y2="3057.959"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="36.1826" y="3053.2168">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.3242" x="57.4473" y="3053.2168">Authentication Credentials ()</text></g><path d="M210.855,3097.959 L272.9937,3097.959 L272.9937,3105.2695 L262.9937,3115.2695 L210.855,3115.2695 L210.855,3097.959" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="210.75" style="stroke:#000000;stroke-width:1.5;" width="2586.1143" x="210.855" y="3097.959"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="225.855" y="3111.5273">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="37.415" x="287.9937" y="3110.5938">[OIDC]</text><g class="message" data-participant-1="Browser" data-participant-2="IdP"><polygon fill="#181818" points="2478.6299,3132.5801,2488.6299,3136.5801,2478.6299,3140.5801,2482.6299,3136.5801" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="2484.6299" y1="3136.5801" y2="3136.5801"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="261.7715" y="3131.8379">23.1.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.4092" x="306.6113" y="3131.8379">Authenticate ()</text></g><g class="message" data-participant-1="IdP" data-participant-2="Browser"><polygon fill="#181818" points="265.7715,3192.5117,255.7715,3196.5117,265.7715,3200.5117,261.7715,3196.5117" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="259.7715" x2="2489.6299" y1="3196.5117" y2="3196.5117"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="115.2671" x="271.7715" y="3161.1484">Do you consent to</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="47.7217" x="391.1519" y="3161.1484">{proxy}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="198.5864" x="304.6777" y="3176.459">having access to your data with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="162.9443" x="304.6777" y="3191.7695">the following permissions</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="48.439" x="471.7354" y="3191.7695">{scope}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="5.4844" x="520.1743" y="3191.7695">?</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="210.855" x2="2796.9692" y1="3205.5117" y2="3205.5117"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="51.4712" x="215.855" y="3216.1465">[OAuth2]</text><g class="message" data-participant-1="Browser" data-participant-2="AuthzServer"><polygon fill="#181818" points="2694.4688,3236.7773,2704.4688,3240.7773,2694.4688,3244.7773,2698.4688,3240.7773" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="2700.4688" y1="3240.7773" y2="3240.7773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="261.7715" y="3236.0352">23.2.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92.4092" x="306.6113" y="3236.0352">Authenticate ()</text></g><g class="message" data-participant-1="AuthzServer" data-participant-2="Browser"><polygon fill="#181818" points="265.7715,3296.709,255.7715,3300.709,265.7715,3304.709,261.7715,3300.709" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="259.7715" x2="2705.4688" y1="3300.709" y2="3300.709"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="115.2671" x="271.7715" y="3265.3457">Do you consent to</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="47.7217" x="391.1519" y="3265.3457">{proxy}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="198.5864" x="304.6777" y="3280.6563">having access to your data with</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="162.9443" x="304.6777" y="3295.9668">the following permissions</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="48.439" x="471.7354" y="3295.9668">{scope}</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="5.4844" x="520.1743" y="3295.9668">?</text></g><g class="message" data-participant-1="User" data-participant-2="Browser"><polygon fill="#181818" points="242.7715,3358.0195,252.7715,3362.0195,242.7715,3366.0195,246.7715,3362.0195" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="29.1826" x2="248.7715" y1="3362.0195" y2="3362.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="36.1826" y="3357.2773">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.061" x="57.4473" y="3357.2773">Consent to Data Sharing ()</text></g><path d="M210.855,3402.0195 L272.9937,3402.0195 L272.9937,3409.3301 L262.9937,3419.3301 L210.855,3419.3301 L210.855,3402.0195" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="216.1289" style="stroke:#000000;stroke-width:1.5;" width="2586.1143" x="210.855" y="3402.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="225.855" y="3415.5879">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="37.415" x="287.9937" y="3414.6543">[OIDC]</text><g class="message" data-participant-1="Browser" data-participant-2="IdP"><polygon fill="#181818" points="2478.6299,3436.6406,2488.6299,3440.6406,2478.6299,3444.6406,2482.6299,3440.6406" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="2484.6299" y1="3440.6406" y2="3440.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="261.7715" y="3435.8984">25.1.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64.416" x="306.6113" y="3435.8984">Consent ()</text></g><polygon fill="#E0E0E0" points="269,3453.6406,334,3453.6406,344,3464.6406,334,3476.6406,269,3476.6406,259,3464.6406,269,3453.6406" style="stroke:#181818;stroke-width:0.5;"/><a href="https://datatracker.ietf.org/doc/html/rfc6749" target="_top" title="https://datatracker.ietf.org/doc/html/rfc6749" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc6749" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc6749" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="271" y="3470.209">RFC 6749</text></a><g class="message" data-participant-1="IdP" data-participant-2="Browser"><polygon fill="#181818" points="265.7715,3499.2617,255.7715,3503.2617,265.7715,3507.2617,261.7715,3503.2617" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="259.7715" x2="2489.6299" y1="3503.2617" y2="3503.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="289.8911" x="271.7715" y="3498.5195">302 Found, Location:{redirect_uri?code&amp;state}</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="210.855" x2="2796.9692" y1="3512.2617" y2="3512.2617"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="51.4712" x="215.855" y="3522.8965">[OAuth2]</text><g class="message" data-participant-1="Browser" data-participant-2="AuthzServer"><polygon fill="#181818" points="2694.4688,3543.5273,2704.4688,3547.5273,2694.4688,3551.5273,2698.4688,3547.5273" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="2700.4688" y1="3547.5273" y2="3547.5273"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="261.7715" y="3542.7852">25.2.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64.416" x="306.6113" y="3542.7852">Consent ()</text></g><polygon fill="#E0E0E0" points="269,3560.5273,334,3560.5273,344,3571.5273,334,3583.5273,269,3583.5273,259,3571.5273,269,3560.5273" style="stroke:#181818;stroke-width:0.5;"/><a href="https://datatracker.ietf.org/doc/html/rfc6749" target="_top" title="https://datatracker.ietf.org/doc/html/rfc6749" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc6749" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc6749" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="271" y="3577.0957">RFC 6749</text></a><g class="message" data-participant-1="AuthzServer" data-participant-2="Browser"><polygon fill="#181818" points="265.7715,3606.1484,255.7715,3610.1484,265.7715,3614.1484,261.7715,3610.1484" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="259.7715" x2="2705.4688" y1="3610.1484" y2="3610.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="289.8911" x="271.7715" y="3605.4063">302 Found, Location:{redirect_uri?code&amp;state}</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="3354.5073" x="0" y="3670.2148"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="3670.2148" y2="3670.2148"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="3673.2148" y2="3673.2148"/><rect fill="#FFFFFF" height="22.1328" style="stroke:#696969;stroke-width:1;" width="275.7559" x="1539.3757" y="3660.1484"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="158.9238" x="1596.7917" y="3675.75">Get Authorization Tokens</text><g class="message" data-participant-1="Browser" data-participant-2="Gtw"><polygon fill="#181818" points="1636.7593,3724.9023,1646.7593,3728.9023,1636.7593,3732.9023,1640.7593,3728.9023" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="1642.7593" y1="3728.9023" y2="3728.9023"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="261.7715" y="3708.8496">26.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.3135" x="294.8237" y="3708.8496">Authorization Request Callback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.5239" x="294.6777" y="3724.1602">(code, state)</text></g><g class="message" data-participant-1="Gtw" data-participant-2="ProxyAuthzServer"><polygon fill="#181818" points="2170.1875,3769.5234,2180.1875,3773.5234,2170.1875,3777.5234,2174.1875,3773.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="2176.1875" y1="3773.5234" y2="3773.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="1655.7593" y="3753.4707">26.2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.3135" x="1688.8115" y="3753.4707">Authorization Request Callback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77.5239" x="1688.6655" y="3768.7813">(code, state)</text></g><path d="M2072.4888,3788.5234 L2134.6274,3788.5234 L2134.6274,3795.834 L2124.6274,3805.834 L2072.4888,3805.834 L2072.4888,3788.5234" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="466.5449" style="stroke:#000000;stroke-width:1.5;" width="844.8188" x="2072.4888" y="3788.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="2087.4888" y="3802.0918">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="37.415" x="2149.6274" y="3801.1582">[OIDC]</text><polygon fill="#E0E0E0" points="2197,3810.834,2336,3810.834,2346,3821.834,2336,3833.834,2197,3833.834,2187,3821.834,2197,3810.834" style="stroke:#181818;stroke-width:0.5;"/><a href="https://openid.net/specs/openid-connect-core-1_0.html" target="_top" title="https://openid.net/specs/openid-connect-core-1_0.html" xlink:actuate="onRequest" xlink:href="https://openid.net/specs/openid-connect-core-1_0.html" xlink:show="new" xlink:title="https://openid.net/specs/openid-connect-core-1_0.html" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="66.2314" x="2199" y="3827.4023">OIDC Core</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2265.2314" y="3827.4023">,</text><a href="https://datatracker.ietf.org/doc/html/rfc7636" target="_top" title="https://datatracker.ietf.org/doc/html/rfc7636" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc7636" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc7636" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="2273.458" y="3827.4023">RFC 7636</text></a><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="IdP"><polygon fill="#181818" points="2478.6299,3887.0762,2488.6299,3891.0762,2478.6299,3895.0762,2482.6299,3891.0762" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="2182.1875" x2="2484.6299" y1="3891.0762" y2="3891.0762"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="2189.1875" y="3855.7129">27.1.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.4165" x="2234.0273" y="3855.7129">OIDC Get Token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.4497" x="2222.0938" y="3871.0234">(code, client_id, client_secret,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84.9443" x="2222.0938" y="3886.334">code_verifier)</text></g><g class="message" data-participant-1="IdP" data-participant-2="IdP"><line style="stroke:#181818;stroke-width:1;" x1="2490.6299" x2="2532.6299" y1="3935.6973" y2="3935.6973"/><line style="stroke:#181818;stroke-width:1;" x1="2532.6299" x2="2532.6299" y1="3935.6973" y2="3948.6973"/><line style="stroke:#181818;stroke-width:1;" x1="2491.6299" x2="2532.6299" y1="3948.6973" y2="3948.6973"/><polygon fill="#181818" points="2501.6299,3944.6973,2491.6299,3948.6973,2501.6299,3952.6973,2497.6299,3948.6973" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="2497.6299" y="3915.6445">27.1.2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.0737" x="2542.4697" y="3915.6445">Generate Authentication</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55.7959" x="2530.5361" y="3930.9551">Token ():</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="54.1963" x="2590.4453" y="3930.9551">id_token</text></g><g class="message" data-participant-1="IdP" data-participant-2="AuthzServer"><polygon fill="#181818" points="2694.4688,3989.3184,2704.4688,3993.3184,2694.4688,3997.3184,2698.4688,3993.3184" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="2490.6299" x2="2700.4688" y1="3993.3184" y2="3993.3184"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="2497.6299" y="3973.2656">27.1.3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.999" x="2542.4697" y="3973.2656">Generate Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58.3096" x="2530.5361" y="3988.5762">Tokens ()</text></g><g class="message" data-participant-1="AuthzServer" data-participant-2="IdP"><polygon fill="#181818" points="2501.6299,4018.6289,2491.6299,4022.6289,2501.6299,4026.6289,2497.6299,4022.6289" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="2495.6299" x2="2705.4688" y1="4022.6289" y2="4022.6289"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="178.3311" x="2507.6299" y="4017.8867">access_token, refresh_token</text></g><g class="message" data-participant-1="IdP" data-participant-2="ProxyAuthzServer"><polygon fill="#181818" points="2193.1875,4047.9395,2183.1875,4051.9395,2193.1875,4055.9395,2189.1875,4051.9395" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="2187.1875" x2="2489.6299" y1="4051.9395" y2="4051.9395"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="240.7539" x="2199.1875" y="4047.1973">access_token, refresh_token, id_token</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="2072.4888" x2="2917.3076" y1="4060.9395" y2="4060.9395"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="51.4712" x="2077.4888" y="4071.5742">[OAuth2]</text><polygon fill="#E0E0E0" points="2197,4079.8945,2331,4079.8945,2341,4090.8945,2331,4102.8945,2197,4102.8945,2187,4090.8945,2197,4079.8945" style="stroke:#181818;stroke-width:0.5;"/><a href="https://datatracker.ietf.org/doc/html/rfc6749" target="_top" title="https://datatracker.ietf.org/doc/html/rfc6749" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc6749" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc6749" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="2199" y="4096.4629">RFC 6749</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="2260.1787" y="4096.4629">,</text><a href="https://datatracker.ietf.org/doc/html/rfc7636" target="_top" title="https://datatracker.ietf.org/doc/html/rfc7636" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc7636" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc7636" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="2268.4053" y="4096.4629">RFC 7636</text></a><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="AuthzServer"><polygon fill="#181818" points="2694.4688,4156.1367,2704.4688,4160.1367,2694.4688,4164.1367,2698.4688,4160.1367" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="2182.1875" x2="2700.4688" y1="4160.1367" y2="4160.1367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="2189.1875" y="4124.7734">27.2.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.127" x="2234.0273" y="4124.7734">OAuth2 Get Token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.4497" x="2222.0938" y="4140.084">(code, client_id, client_secret,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84.9443" x="2222.0938" y="4155.3945">code_verifier)</text></g><g class="message" data-participant-1="AuthzServer" data-participant-2="AuthzServer"><line style="stroke:#181818;stroke-width:1;" x1="2706.4688" x2="2748.4688" y1="4204.7578" y2="4204.7578"/><line style="stroke:#181818;stroke-width:1;" x1="2748.4688" x2="2748.4688" y1="4204.7578" y2="4217.7578"/><line style="stroke:#181818;stroke-width:1;" x1="2707.4688" x2="2748.4688" y1="4217.7578" y2="4217.7578"/><polygon fill="#181818" points="2717.4688,4213.7578,2707.4688,4217.7578,2717.4688,4221.7578,2713.4688,4217.7578" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="2713.4688" y="4184.7051">27.2.2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146.999" x="2758.3086" y="4184.7051">Generate Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58.3096" x="2746.375" y="4200.0156">Tokens ()</text></g><g class="message" data-participant-1="AuthzServer" data-participant-2="ProxyAuthzServer"><polygon fill="#181818" points="2193.1875,4243.0684,2183.1875,4247.0684,2193.1875,4251.0684,2189.1875,4247.0684" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="2187.1875" x2="2705.4688" y1="4247.0684" y2="4247.0684"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="40.7266" x="2199.1875" y="4242.3262">27.2.1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="178.3311" x="2244.0273" y="4242.3262">access_token, refresh_token</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="ProxyAuthzServer"><line style="stroke:#181818;stroke-width:1;" x1="2182.1875" x2="2224.1875" y1="4298.6895" y2="4298.6895"/><line style="stroke:#181818;stroke-width:1;" x1="2224.1875" x2="2224.1875" y1="4298.6895" y2="4311.6895"/><line style="stroke:#181818;stroke-width:1;" x1="2183.1875" x2="2224.1875" y1="4311.6895" y2="4311.6895"/><polygon fill="#181818" points="2193.1875,4307.6895,2183.1875,4311.6895,2193.1875,4315.6895,2189.1875,4311.6895" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="2189.1875" y="4278.6367">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.9194" x="2210.4521" y="4278.6367">Generate Proxy</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.4209" x="2222.0938" y="4293.9473">Authorization Code ()</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="ProxyAuthzServer"><line style="stroke:#181818;stroke-width:1;" x1="2182.1875" x2="2224.1875" y1="4371.6211" y2="4371.6211"/><line style="stroke:#181818;stroke-width:1;" x1="2224.1875" x2="2224.1875" y1="4371.6211" y2="4384.6211"/><line style="stroke:#181818;stroke-width:1;" x1="2183.1875" x2="2224.1875" y1="4384.6211" y2="4384.6211"/><polygon fill="#181818" points="2193.1875,4380.6211,2183.1875,4384.6211,2193.1875,4388.6211,2189.1875,4384.6211" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="2189.1875" y="4336.2578">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.5874" x="2210.4521" y="4336.2578">Persist Authorization Code</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249.2788" x="2222.0938" y="4351.5684">Mapping (proxy_code -&gt; access_token,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.0825" x="2222.0938" y="4366.8789">refresh_token)</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="Gtw"><polygon fill="#181818" points="1659.7593,4409.9316,1649.7593,4413.9316,1659.7593,4417.9316,1655.7593,4413.9316" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1653.7593" x2="2181.1875" y1="4413.9316" y2="4413.9316"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="1665.7593" y="4409.1895">26.2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="418.1455" x="1698.8115" y="4409.1895">302 Found, Location:{proxy_redirect_uri?proxy_code&amp;proxy_state}</text></g><g class="message" data-participant-1="Gtw" data-participant-2="Browser"><polygon fill="#181818" points="265.7715,4439.2422,255.7715,4443.2422,265.7715,4447.2422,261.7715,4443.2422" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="259.7715" x2="1647.7593" y1="4443.2422" y2="4443.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="271.7715" y="4438.5">26.1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="418.1455" x="304.8237" y="4438.5">302 Found, Location:{proxy_redirect_uri?proxy_code&amp;proxy_state}</text></g><g class="message" data-participant-1="Browser" data-participant-2="MCPServer"><polygon fill="#181818" points="1315.873,4483.8633,1325.873,4487.8633,1315.873,4491.8633,1319.873,4487.8633" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="1321.873" y1="4487.8633" y2="4487.8633"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="261.7715" y="4467.8105">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237.6816" x="283.0361" y="4467.8105">Proxy Authorization Request Callback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163.0269" x="294.6777" y="4483.1211">(proxy_code, proxy_state)</text></g><g class="message" data-participant-1="MCPServer" data-participant-2="MCPServer"><line style="stroke:#181818;stroke-width:1;" x1="1327.873" x2="1369.873" y1="4532.4844" y2="4532.4844"/><line style="stroke:#181818;stroke-width:1;" x1="1369.873" x2="1369.873" y1="4532.4844" y2="4545.4844"/><line style="stroke:#181818;stroke-width:1;" x1="1328.873" x2="1369.873" y1="4545.4844" y2="4545.4844"/><polygon fill="#181818" points="1338.873,4541.4844,1328.873,4545.4844,1338.873,4549.4844,1334.873,4545.4844" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1334.873" y="4512.4316">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.6187" x="1356.1377" y="4512.4316">Load Proxy Code Exchange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58.1953" x="1367.7793" y="4527.7422">Params():</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="186.1577" x="1430.0879" y="4527.7422">proxy_code_verifier, resource</text></g><g class="message" data-participant-1="MCPServer" data-participant-2="Gtw"><polygon fill="#181818" points="1636.7593,4616.7266,1646.7593,4620.7266,1636.7593,4624.7266,1640.7593,4620.7266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1327.873" x2="1642.7593" y1="4620.7266" y2="4620.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="1334.873" y="4570.0527">32.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117.127" x="1367.9253" y="4570.0527">OAuth2 Get Token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.9263" x="1367.7793" y="4585.3633">(proxy_code, proxy_client_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.6646" x="1367.7793" y="4600.6738">proxy_client_secret,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.3853" x="1367.7793" y="4615.9844">proxy_code_verifier, resource)</text></g><g class="message" data-participant-1="Gtw" data-participant-2="ProxyAuthzServer"><polygon fill="#181818" points="2170.1875,4646.0371,2180.1875,4650.0371,2170.1875,4654.0371,2174.1875,4650.0371" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="2176.1875" y1="4650.0371" y2="4650.0371"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="1655.7593" y="4645.2949">32.2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.0352" x="1688.8115" y="4645.2949">OAuth2 Get Token (...)</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="ProxyAuthzServer"><line style="stroke:#181818;stroke-width:1;" x1="2182.1875" x2="2224.1875" y1="4694.6582" y2="4694.6582"/><line style="stroke:#181818;stroke-width:1;" x1="2224.1875" x2="2224.1875" y1="4694.6582" y2="4707.6582"/><line style="stroke:#181818;stroke-width:1;" x1="2183.1875" x2="2224.1875" y1="4707.6582" y2="4707.6582"/><polygon fill="#181818" points="2193.1875,4703.6582,2183.1875,4707.6582,2193.1875,4711.6582,2189.1875,4707.6582" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="2189.1875" y="4674.6055">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75.7593" x="2210.4521" y="4674.6055">Verify Proxy</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.4209" x="2222.0938" y="4689.916">Authorization Code ()</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="ProxyAuthzServer"><line style="stroke:#181818;stroke-width:1;" x1="2182.1875" x2="2224.1875" y1="4752.2793" y2="4752.2793"/><line style="stroke:#181818;stroke-width:1;" x1="2224.1875" x2="2224.1875" y1="4752.2793" y2="4765.2793"/><line style="stroke:#181818;stroke-width:1;" x1="2183.1875" x2="2224.1875" y1="4765.2793" y2="4765.2793"/><polygon fill="#181818" points="2193.1875,4761.2793,2183.1875,4765.2793,2193.1875,4769.2793,2189.1875,4765.2793" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="2189.1875" y="4732.2266">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.9194" x="2210.4521" y="4732.2266">Generate Proxy</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.7573" x="2222.0938" y="4747.5371">Authorization Tokens ()</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="ProxyAuthzServer"><line style="stroke:#181818;stroke-width:1;" x1="2182.1875" x2="2224.1875" y1="4825.2109" y2="4825.2109"/><line style="stroke:#181818;stroke-width:1;" x1="2224.1875" x2="2224.1875" y1="4825.2109" y2="4838.2109"/><line style="stroke:#181818;stroke-width:1;" x1="2183.1875" x2="2224.1875" y1="4838.2109" y2="4838.2109"/><polygon fill="#181818" points="2193.1875,4834.2109,2183.1875,4838.2109,2193.1875,4842.2109,2189.1875,4838.2109" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="2189.1875" y="4789.8477">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240.7095" x="2210.4521" y="4789.8477">Persist Authorization Tokens Mapping</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243.6738" x="2222.0938" y="4805.1582">(proxy_access_token -&gt; access_token,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246.7715" x="2222.0938" y="4820.4688">proxy_refresh_token -&gt; refresh_token)</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="Gtw"><polygon fill="#181818" points="1659.7593,4863.5215,1649.7593,4867.5215,1659.7593,4871.5215,1655.7593,4867.5215" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1653.7593" x2="2181.1875" y1="4867.5215" y2="4867.5215"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="1665.7593" y="4862.7793">32.2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="263.834" x="1698.8115" y="4862.7793">proxy_access_token, proxy_refresh_token</text></g><g class="message" data-participant-1="Gtw" data-participant-2="MCPServer"><polygon fill="#181818" points="1338.873,4892.832,1328.873,4896.832,1338.873,4900.832,1334.873,4896.832" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1332.873" x2="1647.7593" y1="4896.832" y2="4896.832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="28.939" x="1344.873" y="4892.0898">32.1</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="263.834" x="1377.9253" y="4892.0898">proxy_access_token, proxy_refresh_token</text></g><g class="message" data-participant-1="MCPServer" data-participant-2="Browser"><polygon fill="#181818" points="265.7715,4922.1426,255.7715,4926.1426,265.7715,4930.1426,261.7715,4926.1426" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="259.7715" x2="1326.873" y1="4926.1426" y2="4926.1426"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="271.7715" y="4921.4004">29</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="96.3384" x="293.0361" y="4921.4004">html, js, css, ...</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="3354.5073" x="0" y="4954.209"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="4954.209" y2="4954.209"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="4957.209" y2="4957.209"/><rect fill="#FFFFFF" height="22.1328" style="stroke:#696969;stroke-width:1;" width="224.5918" x="1564.9578" y="4944.1426"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="107.7598" x="1622.3738" y="4959.7441">React to Stimulus</text><g class="message" data-participant-1="Browser" data-participant-2="Agent"><polygon fill="#181818" points="637.1699,4993.5859,647.1699,4997.5859,637.1699,5001.5859,641.1699,4997.5859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="643.1699" y1="4997.5859" y2="4997.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="261.7715" y="4992.8438">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.9868" x="283.0361" y="4992.8438">User Authentication Completed ()</text></g><g class="message" data-participant-1="Agent" data-participant-2="Browser"><polygon fill="#181818" points="265.7715,5022.8965,255.7715,5026.8965,265.7715,5030.8965,261.7715,5026.8965" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="259.7715" x2="648.1699" y1="5026.8965" y2="5026.8965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="47.3599" x="271.7715" y="5022.1543">200 OK</text></g><g class="message" data-participant-1="Agent" data-participant-2="MCPClient"><polygon fill="#181818" points="1032.1523,5052.207,1042.1523,5056.207,1032.1523,5060.207,1036.1523,5056.207" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.1699" x2="1038.1523" y1="5056.207" y2="5056.207"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="656.1699" y="5051.4648">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.2749" x="677.4346" y="5051.4648">Perform Task ()</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="3354.5073" x="0" y="5084.2734"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="5084.2734" y2="5084.2734"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="5087.2734" y2="5087.2734"/><rect fill="#FFFFFF" height="22.1328" style="stroke:#696969;stroke-width:1;" width="238.2266" x="1558.1404" y="5074.207"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="121.3945" x="1615.5564" y="5089.8086">Access Private Data</text><polygon fill="#E0E0E0" points="1059,5111.3398,1253,5111.3398,1263,5122.3398,1253,5134.3398,1059,5134.3398,1049,5122.3398,1059,5111.3398" style="stroke:#181818;stroke-width:0.5;"/><a href="https://modelcontextprotocol.io/specification/2025-03-26/basic/authorization" target="_top" title="https://modelcontextprotocol.io/specification/2025-03-26/basic/authorization" xlink:actuate="onRequest" xlink:href="https://modelcontextprotocol.io/specification/2025-03-26/basic/authorization" xlink:show="new" xlink:title="https://modelcontextprotocol.io/specification/2025-03-26/basic/authorization" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="102.1084" x="1061" y="5127.9082">MCP Authz Spec</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1163.1084" y="5127.9082">,</text><a href="https://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/schema/2025-03-26/schema.ts" target="_top" title="https://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/schema/2025-03-26/schema.ts" xlink:actuate="onRequest" xlink:href="https://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/schema/2025-03-26/schema.ts" xlink:show="new" xlink:title="https://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/schema/2025-03-26/schema.ts" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="79.7773" x="1171.335" y="5127.9082">MCP Schema</text></a><g class="message" data-participant-1="MCPClient" data-participant-2="MCPServer"><polygon fill="#181818" points="1315.873,5156.9609,1325.873,5160.9609,1315.873,5164.9609,1319.873,5160.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1044.1523" x2="1321.873" y1="5160.9609" y2="5160.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1051.1523" y="5156.2188">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.3198" x="1072.417" y="5156.2188">Call Tool ()</text></g><g class="message" data-participant-1="MCPServer" data-participant-2="MCPServer"><line style="stroke:#181818;stroke-width:1;" x1="1327.873" x2="1369.873" y1="5220.8926" y2="5220.8926"/><line style="stroke:#181818;stroke-width:1;" x1="1369.873" x2="1369.873" y1="5220.8926" y2="5233.8926"/><line style="stroke:#181818;stroke-width:1;" x1="1328.873" x2="1369.873" y1="5233.8926" y2="5233.8926"/><polygon fill="#181818" points="1338.873,5229.8926,1328.873,5233.8926,1338.873,5237.8926,1334.873,5233.8926" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1334.873" y="5185.5293">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.0942" x="1356.1377" y="5185.5293">Load Proxy Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62.4229" x="1367.7793" y="5200.8398">Tokens ():</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="130.1143" x="1434.3154" y="5200.8398">proxy_access_token,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="129.6064" x="1367.7793" y="5216.1504">proxy_refresh_token</text></g><g class="message" data-participant-1="MCPServer" data-participant-2="Gtw"><polygon fill="#181818" points="1636.7593,5274.5137,1646.7593,5278.5137,1636.7593,5282.5137,1640.7593,5278.5137" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1327.873" x2="1642.7593" y1="5278.5137" y2="5278.5137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1334.873" y="5258.4609">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.7886" x="1356.1377" y="5258.4609">Retrieve Context Data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.4561" x="1367.7793" y="5273.7715">(proxy_access_token)</text></g><g class="message" data-participant-1="Gtw" data-participant-2="ProxyAuthzServer"><polygon fill="#181818" points="2170.1875,5319.1348,2180.1875,5323.1348,2170.1875,5327.1348,2174.1875,5323.1348" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="2176.1875" y1="5323.1348" y2="5323.1348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1655.7593" y="5303.082">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.8823" x="1677.0239" y="5303.082">OAuth2 Proxy Token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221.9331" x="1688.6655" y="5318.3926">Introspection (proxy_access_token)</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="Gtw"><polygon fill="#181818" points="1659.7593,5348.4453,1649.7593,5352.4453,1659.7593,5356.4453,1655.7593,5352.4453" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1653.7593" x2="2181.1875" y1="5352.4453" y2="5352.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="151.5757" x="1665.7593" y="5347.7031">exp, scope, resource, ...</text></g><g class="message" data-participant-1="Gtw" data-participant-2="Gtw"><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="1690.7593" y1="5381.7559" y2="5381.7559"/><line style="stroke:#181818;stroke-width:1;" x1="1690.7593" x2="1690.7593" y1="5381.7559" y2="5394.7559"/><line style="stroke:#181818;stroke-width:1;" x1="1649.7593" x2="1690.7593" y1="5394.7559" y2="5394.7559"/><polygon fill="#181818" points="1659.7593,5390.7559,1649.7593,5394.7559,1659.7593,5398.7559,1655.7593,5394.7559" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1655.7593" y="5377.0137">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201.8491" x="1677.0239" y="5377.0137">Verify Proxy Access Token (exp)</text></g><polygon fill="#E0E0E0" points="1663,5407.7559,1797,5407.7559,1807,5418.7559,1797,5430.7559,1663,5430.7559,1653,5418.7559,1663,5407.7559" style="stroke:#181818;stroke-width:0.5;"/><a href="https://datatracker.ietf.org/doc/html/rfc6950" target="_top" title="https://datatracker.ietf.org/doc/html/rfc6950" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc6950" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc6950" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="1665" y="5424.3242">RFC 6950</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1133" x="1726.1787" y="5424.3242">,</text><a href="https://datatracker.ietf.org/doc/html/rfc8707" target="_top" title="https://datatracker.ietf.org/doc/html/rfc8707" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc8707" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc8707" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="1734.4053" y="5424.3242">RFC 8707</text></a><g class="message" data-participant-1="Gtw" data-participant-2="Gtw"><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="1690.7593" y1="5457.377" y2="5457.377"/><line style="stroke:#181818;stroke-width:1;" x1="1690.7593" x2="1690.7593" y1="5457.377" y2="5470.377"/><line style="stroke:#181818;stroke-width:1;" x1="1649.7593" x2="1690.7593" y1="5470.377" y2="5470.377"/><polygon fill="#181818" points="1659.7593,5466.377,1649.7593,5470.377,1659.7593,5474.377,1655.7593,5470.377" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1655.7593" y="5452.6348">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244.3848" x="1677.0239" y="5452.6348">Verify Permission Set (scope, resource)</text></g><g class="message" data-participant-1="Gtw" data-participant-2="ProxyAuthzServer"><polygon fill="#181818" points="2170.1875,5510.998,2180.1875,5514.998,2170.1875,5518.998,2174.1875,5514.998" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="2176.1875" y1="5514.998" y2="5514.998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1655.7593" y="5494.9453">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.1748" x="1677.0239" y="5494.9453">Get Authorization Token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193.2417" x="1688.6655" y="5510.2559">Mapping (proxy_access_token)</text></g><g class="message" data-participant-1="ProxyAuthzServer" data-participant-2="Gtw"><polygon fill="#181818" points="1659.7593,5540.3086,1649.7593,5544.3086,1659.7593,5548.3086,1655.7593,5544.3086" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1653.7593" x2="2181.1875" y1="5544.3086" y2="5544.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="83.2495" x="1665.7593" y="5539.5664">access_token</text></g><g class="message" data-participant-1="Gtw" data-participant-2="DataServer"><polygon fill="#181818" points="2918.7246,5569.6191,2928.7246,5573.6191,2918.7246,5577.6191,2922.7246,5573.6191" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1648.7593" x2="2924.7246" y1="5573.6191" y2="5573.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1655.7593" y="5568.877">45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233.6064" x="1677.0239" y="5568.877">Retrieve Context Data (access_token)</text></g><polygon fill="#E0E0E0" points="2721,5586.6191,2786,5586.6191,2796,5597.6191,2786,5609.6191,2721,5609.6191,2711,5597.6191,2721,5586.6191" style="stroke:#181818;stroke-width:0.5;"/><a href="https://datatracker.ietf.org/doc/html/rfc7662" target="_top" title="https://datatracker.ietf.org/doc/html/rfc7662" xlink:actuate="onRequest" xlink:href="https://datatracker.ietf.org/doc/html/rfc7662" xlink:show="new" xlink:title="https://datatracker.ietf.org/doc/html/rfc7662" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="61.1787" x="2723" y="5603.1875">RFC 7662</text></a><g class="message" data-participant-1="DataServer" data-participant-2="AuthzServer"><polygon fill="#181818" points="2717.4688,5647.5508,2707.4688,5651.5508,2717.4688,5655.5508,2713.4688,5651.5508" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="2711.4688" x2="2929.7246" y1="5651.5508" y2="5651.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="2723.4688" y="5631.498">46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.9912" x="2744.7334" y="5631.498">OAuth2 Token Introspection</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.7046" x="2756.375" y="5646.8086">(access_token)</text></g><g class="message" data-participant-1="AuthzServer" data-participant-2="DataServer"><polygon fill="#181818" points="2918.7246,5676.8613,2928.7246,5680.8613,2918.7246,5684.8613,2922.7246,5680.8613" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="2706.4688" x2="2924.7246" y1="5680.8613" y2="5680.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="88.8862" x="2713.4688" y="5676.1191">exp, scope, ...</text></g><g class="message" data-participant-1="DataServer" data-participant-2="DataServer"><line style="stroke:#181818;stroke-width:1;" x1="2930.7246" x2="2972.7246" y1="5710.1719" y2="5710.1719"/><line style="stroke:#181818;stroke-width:1;" x1="2972.7246" x2="2972.7246" y1="5710.1719" y2="5723.1719"/><line style="stroke:#181818;stroke-width:1;" x1="2931.7246" x2="2972.7246" y1="5723.1719" y2="5723.1719"/><polygon fill="#181818" points="2941.7246,5719.1719,2931.7246,5723.1719,2941.7246,5727.1719,2937.7246,5723.1719" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="2937.7246" y="5705.4297">47</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.481" x="2958.9893" y="5705.4297">Verify Access Token (exp)</text></g><g class="message" data-participant-1="DataServer" data-participant-2="DataServer"><line style="stroke:#181818;stroke-width:1;" x1="2930.7246" x2="2972.7246" y1="5752.4824" y2="5752.4824"/><line style="stroke:#181818;stroke-width:1;" x1="2972.7246" x2="2972.7246" y1="5752.4824" y2="5765.4824"/><line style="stroke:#181818;stroke-width:1;" x1="2931.7246" x2="2972.7246" y1="5765.4824" y2="5765.4824"/><polygon fill="#181818" points="2941.7246,5761.4824,2931.7246,5765.4824,2941.7246,5769.4824,2937.7246,5765.4824" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="2937.7246" y="5747.7402">48</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181.6953" x="2958.9893" y="5747.7402">Verify Permission Set (scope)</text></g><g class="message" data-participant-1="DataServer" data-participant-2="Gtw"><polygon fill="#181818" points="1659.7593,5790.793,1649.7593,5794.793,1659.7593,5798.793,1655.7593,5794.793" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1653.7593" x2="2929.7246" y1="5794.793" y2="5794.793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1665.7593" y="5790.0508">45</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="81.5547" x="1687.0239" y="5790.0508">context_data</text></g><g class="message" data-participant-1="Gtw" data-participant-2="MCPServer"><polygon fill="#181818" points="1338.873,5820.1035,1328.873,5824.1035,1338.873,5828.1035,1334.873,5824.1035" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1332.873" x2="1647.7593" y1="5824.1035" y2="5824.1035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1344.873" y="5819.3613">40</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="81.5547" x="1366.1377" y="5819.3613">context_data</text></g><g class="message" data-participant-1="MCPServer" data-participant-2="MCPClient"><polygon fill="#181818" points="1055.1523,5849.4141,1045.1523,5853.4141,1055.1523,5857.4141,1051.1523,5853.4141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="1049.1523" x2="1326.873" y1="5853.4141" y2="5853.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1061.1523" y="5848.6719">38</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="81.5547" x="1082.417" y="5848.6719">context_data</text></g><g class="message" data-participant-1="MCPClient" data-participant-2="MCPClient"><line style="stroke:#181818;stroke-width:1;" x1="1044.1523" x2="1086.1523" y1="5882.7246" y2="5882.7246"/><line style="stroke:#181818;stroke-width:1;" x1="1086.1523" x2="1086.1523" y1="5882.7246" y2="5895.7246"/><line style="stroke:#181818;stroke-width:1;" x1="1045.1523" x2="1086.1523" y1="5895.7246" y2="5895.7246"/><polygon fill="#181818" points="1055.1523,5891.7246,1045.1523,5895.7246,1055.1523,5899.7246,1051.1523,5895.7246" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1051.1523" y="5877.9824">49</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60.2139" x="1072.417" y="5877.9824">Process ()</text></g><g class="message" data-participant-1="MCPClient" data-participant-2="Agent"><polygon fill="#181818" points="660.1699,5921.0352,650.1699,5925.0352,660.1699,5929.0352,656.1699,5925.0352" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="654.1699" x2="1043.1523" y1="5925.0352" y2="5925.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="666.1699" y="5920.293">37</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="96.1797" x="687.4346" y="5920.293">context_output</text></g><g class="message" data-participant-1="Agent" data-participant-2="Agent"><line style="stroke:#181818;stroke-width:1;" x1="649.1699" x2="691.1699" y1="5954.3457" y2="5954.3457"/><line style="stroke:#181818;stroke-width:1;" x1="691.1699" x2="691.1699" y1="5954.3457" y2="5967.3457"/><line style="stroke:#181818;stroke-width:1;" x1="650.1699" x2="691.1699" y1="5967.3457" y2="5967.3457"/><polygon fill="#181818" points="660.1699,5963.3457,650.1699,5967.3457,660.1699,5971.3457,656.1699,5967.3457" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="656.1699" y="5949.6035">50</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60.2139" x="677.4346" y="5949.6035">Process ()</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="3354.5073" x="0" y="5995.4121"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="5995.4121" y2="5995.4121"/><line style="stroke:#696969;stroke-width:0.5;" x1="0" x2="3354.5073" y1="5998.4121" y2="5998.4121"/><rect fill="#FFFFFF" height="22.1328" style="stroke:#696969;stroke-width:1;" width="236.1699" x="1559.1687" y="5985.3457"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="119.3379" x="1616.5847" y="6000.9473">Generate AI Output</text><polygon fill="#E0E0E0" points="664,6022.4785,790,6022.4785,800,6033.4785,790,6045.4785,664,6045.4785,654,6033.4785,664,6022.4785" style="stroke:#181818;stroke-width:0.5;"/><a href="\w" target="_top" title="\w" xlink:actuate="onRequest" xlink:href="\w" xlink:show="new" xlink:title="\w" xlink:type="simple"><text fill="#354F52" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="122.332" x="666" y="6039.0469">LLM Proprietary API</text></a><g class="message" data-participant-1="Agent" data-participant-2="LLM"><polygon fill="#181818" points="3135.6846,6083.4102,3145.6846,6087.4102,3135.6846,6091.4102,3139.6846,6087.4102" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="649.1699" x2="3141.6846" y1="6087.4102" y2="6087.4102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="656.1699" y="6067.3574">51</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163.6743" x="677.4346" y="6067.3574">LLM API (api_key, prompt,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.4072" x="689.0762" y="6082.668">context_output)</text></g><g class="message" data-participant-1="LLM" data-participant-2="LLM"><line style="stroke:#181818;stroke-width:1;" x1="3147.6846" x2="3189.6846" y1="6116.7207" y2="6116.7207"/><line style="stroke:#181818;stroke-width:1;" x1="3189.6846" x2="3189.6846" y1="6116.7207" y2="6129.7207"/><line style="stroke:#181818;stroke-width:1;" x1="3148.6846" x2="3189.6846" y1="6129.7207" y2="6129.7207"/><polygon fill="#181818" points="3158.6846,6125.7207,3148.6846,6129.7207,3158.6846,6133.7207,3154.6846,6129.7207" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="3154.6846" y="6111.9785">52</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.5581" x="3175.9492" y="6111.9785">Verify Credentials (api_key)</text></g><g class="message" data-participant-1="LLM" data-participant-2="LLM"><line style="stroke:#181818;stroke-width:1;" x1="3147.6846" x2="3189.6846" y1="6174.3418" y2="6174.3418"/><line style="stroke:#181818;stroke-width:1;" x1="3189.6846" x2="3189.6846" y1="6174.3418" y2="6187.3418"/><line style="stroke:#181818;stroke-width:1;" x1="3148.6846" x2="3189.6846" y1="6187.3418" y2="6187.3418"/><polygon fill="#181818" points="3158.6846,6183.3418,3148.6846,6187.3418,3158.6846,6191.3418,3154.6846,6187.3418" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="3154.6846" y="6154.2891">53</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.7676" x="3175.9492" y="6154.2891">Process (prompt,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.4072" x="3187.5908" y="6169.5996">context_output)</text></g><g class="message" data-participant-1="LLM" data-participant-2="Agent"><polygon fill="#181818" points="660.1699,6212.6523,650.1699,6216.6523,660.1699,6220.6523,656.1699,6216.6523" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="654.1699" x2="3146.6846" y1="6216.6523" y2="6216.6523"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="666.1699" y="6211.9102">51</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="111.9727" x="687.4346" y="6211.9102">generated_output</text></g><g class="message" data-participant-1="Agent" data-participant-2="Browser"><line style="stroke:#181818;stroke-width:1;" x1="255.7715" x2="265.7715" y1="6245.9629" y2="6241.9629"/><line style="stroke:#181818;stroke-width:1;" x1="255.7715" x2="265.7715" y1="6245.9629" y2="6249.9629"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="254.7715" x2="648.1699" y1="6245.9629" y2="6245.9629"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44.0972" x="271.7715" y="6241.2207">54 SSE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.4243" x="319.9819" y="6241.2207">Generated Output Available ()</text></g><g class="message" data-participant-1="Browser" data-participant-2="Agent"><polygon fill="#181818" points="637.1699,6271.2734,647.1699,6275.2734,637.1699,6279.2734,641.1699,6275.2734" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="643.1699" y1="6275.2734" y2="6275.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="261.7715" y="6270.5313">55</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.2861" x="283.0361" y="6270.5313">Retrieve Generated Output ()</text></g><g class="message" data-participant-1="Browser" data-participant-2="Browser"><line style="stroke:#181818;stroke-width:1;" x1="254.7715" x2="296.7715" y1="6304.584" y2="6304.584"/><line style="stroke:#181818;stroke-width:1;" x1="296.7715" x2="296.7715" y1="6304.584" y2="6317.584"/><line style="stroke:#181818;stroke-width:1;" x1="255.7715" x2="296.7715" y1="6317.584" y2="6317.584"/><polygon fill="#181818" points="265.7715,6313.584,255.7715,6317.584,265.7715,6321.584,261.7715,6317.584" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="261.7715" y="6299.8418">56</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.7031" x="283.0361" y="6299.8418">Display Generated Output ()</text></g><!--SRC=[xLlhKzj84lyS_nMp9hk0rxPi-GMf9IbY84LjM7muR3viKfIG1rjdMV9ACiJ9vd-_xdb8ewVbm3wkxf8gaAsPxfxkNp-cPzWbF_tKAFXNsIL3Tq8hbUyczCvoAFdbyjtfpV3oxUKLgUvq9ZrZqAbMldi-7fqERvHtH_3sj8N_gp1tvVo-SWCw8KlFDUbavL7o_7WoER7khGdrzfu7z5DG9yzlfwPhkzv-fVBCdrlEql2C1V7fxolgc9HygJnxjYkcl3RC-THpLyvaY3F8pecrUECPwu8XtzlMT1PGPw-wSs9uyqlRkgTlF4gTQftqzijF75D3JkkqS5xEDBaQbRBhmS-X-3RsvRkPPSuTwlka7RqwSvqWTttuyXTZGUF3nzPdIlHMOjmuMDiqoJ99-IkeVVVeY6WQiuUcaQEZohEZ8qtxtWyyovdkLOdwhqf-96ma_4wysTSqc5lvZZgJqE8bOG36Hn8PyFX-0jfdPdW_im8wNhXp2aPez_RtIxCQhsvpG0TFTw0f7_HNWB-_mjOAtbxRm0ZNsDelP_bm3VzL0CYtYeA68jErkzyEWK8MEPZBWfm8bBlavSl2W8eZDyPSRgy8XBFradgsvSo5pJgzxbbFh-pkT4vwnuDEEEDfk9ywWHLOr8V1y61JKhsW5EBuhVk9L4_elMNIAjavjk7tQtj5cVv0pi0ohQNX1AHwxLElIWoVu4FwzMlFVP0Zn7C5b4c0lc1oV4w6jaMT0FYycRb-y83gJrCwdh8nG8SziG602PkQWUKwFWW-78MKO1Hyv9yYVhj9Xgh_KMkAzXxiWrQIl7D9xwRMCgRUFQutvjeh-glbsZG0-WUGW395bnCvVVufeQgHvtvQnqWFZGaDa3vGFjJtqrfxOmJqmLWpic-2X_G0HfDSBgb3pay8V69EmSQpL-UJKUwaurKmqmd-_AoApzwoRpDNWMz0TvPfuEghoQJxyyoOMx2SVfQYCkL44TCiNC_wdCr1IUkzLXQJd7NbB-d428mq6njqBspJxcIj1gUf3F1palvkk22dBaJwWQJulJNkOGQGWKeb3y2P04iF1Mq2XzJYpqz66OCBLf1mZRTlB-8IuzDulXOAwcGPWiq1gl1RKSZEXHjOzyoqGZlHwgGCx2EBNJ6M3g_bjjDGo5aDbvkZRvdGB-gDIkMFF_weLDH2I89mJCsLPmLhCZA2W7fETR-II5_LYvKTM4i8tL8uyc05Ct9icbXt12wBp4mhTMAOfhjOsfO_WsGPpA2kcSx8EI1dYV01FOGqJCFprb0847SLS8yc0eJHXyzr4WEc0PfYsh-OBe8gDoXRcNp0tmuaQkAYhMG-aAM4ffrOnXHpuBbpvsfQ9NnJguskhqQNuzDQBVekqisl5dqW3n1KO4aKSh_XqOfQepH8MaSUwDx2IYTIZr1POkf8eYJ0mU5y0_dOjggycBnNfushqtzTdu_FtvsEOsApz0NyfvOF5aKxk8Xm0NIHPs92o3ap668ihPivNIlq5FJ7YN93WJzhgZSZ7uF48dWcIuKiybtYX1kJZRon9ipMiUzyQdeqKEHIS98jNvPa-H9ba4EvGedg92u8cuo-Yu2BGr40ZpHUSiM-08ErQpLowWV6BJg7OF31-H2CcLVSuy-XwpWyDf6z_HWXS7H9ITFqLejS_epmhMJMczKhQfW1Ac0SM8kLlV8X9bLtMC69rJcc2rsKgjT2JC481TL1q7C7b6Y4ekGkgeEBOhBd2imdStp1rB2qmUbTc3wYtfthBSWxmvypNdch4l5cv65ifZn5vQvhngA0Xw6Pk7SHLvBiBhmWl_qs2uAb_qBJ5b1qsoPiSQ1U1-W5BYIBfkLg_fAQrfse9q3zUg_HwZJqldPh-9Qf6Menm60jG0JJFdwiAmoc43TNjqq8aPcyih-yjTrRRM5OZkQRCxemL07uDyt0vzx4Fdtyo3GGBPbhdICEjTvZ1eOeOzYupvFspP_GXmblmQ_8EzUr_H8J1Z1XYC4B9wZZXL_1UAWLSUH14_tYYiAUaDvJz02s2MJHKa0AHkA4AFFpUNhHl2mC89qYwqzWRW2WdrElQT7WhkbwKstYcjeiMDYQTsSU3lG3SdKs9FWWj8n44UkgT9hMRRN9jIDnGI5ql7__lg7KfVG5UKqXmdkQXZ50qppgkolFf3SB6XWeoL6Lo_NJzO-jbdxsKlx6TpvZX32Itt8oIAZvG6sxCNVS1qTpKO860WcY2fqq99Cgn0uKVZUo2Aw1cMGRuP5dhk1SeP6eGiAoykN7WJCBOYuM3R4Y71BdPEbQJb0w9lnfU4Y1zH2W-eO605U-Fd8XTAL2F8qYgGwegjILtd2T-h9-CUo0N9wV3CDajkKwNQWkh4dJeG4BTBxuec7oRDIOMBw9vTIwqRvfDN7nZ1qvaT-BfIlBJsxGMFvhDTlCsK_0zBPhJ3WLyDmxQxho33NjXUbOeO5q8Q67fFJ7aSeLiSDpae_nBeEiIbUQBKMBbmQsJqMvyQscsGZ1Wswxoo283wNjeCVj4FSZeQ8aHFFqc4LT5tX_5E5SsLK3bUQmmLJE99cYme08ZYZJL8d8AECv3v1GZnhsugZA0frUbHuR9KxaecHEP3KenQWk6L7FSxqZWzL6Dx19iEX4ik4rbs0XYovaqNqI5lc5caA4bV681V0Yd-P5vu8IiTtE1DCLxcm102DiQVhIqlaLILlVZao4mpWP1DzRT9gHH-z0CR3H2EU- -E14GLkas7GTAYW_pkq7hG5tUtY8whrKTTNkDgNwejrDk7gqRb81KlnOwPNfYjtGpR-9T6cNxqKQPplAt4YVw-8Cyq9UlgECvrCgAeSwQJQRmcwPbL6eq2sev3jwUnjvSdsvlLcUXRda9KDOeqdAl4qL5X2xCbeM-P78ucXuPejD3fL1DAMCulNl9hDfEJdrICwet_fNI0h9P9S_vbYjtIR5TE9RwTZc7vRM9sDiLC6EUKxv1Xws-l6cDpcptGSPl_UsXeUS2Qz4poD2ZZ6DVmQ9zvCYAn5emAmG8aKHKHW0EUqbcZzrsVc1_V2DEOET97McjAxkD-e4giybbICX45iULAitAyzYuyIQfv9WNE1KT9ELvO152INKP0jDza8gSdgAr04G-fLwrjsQMw_10S13eyt8-JDhcHc-60sDnViw-RTV9wRlCycXQYDhTqLCdaxHyhNQ5xROhy0FioreIzeFH2TthWrOmDOYQqTJdqtWZqTCF_LQJKwerS3aei_5a44uDEh4jXV8O6RS0oavt0XRm22JHrZHjJ0Se3eXj-k8w9TuYuJJ_8fiKqsZADHovFmFg22l4TV6VUCmMYK_TvWPhAaiK7CjzIRdvVYXtcBQ70UkHqEQUnkpF4pJYwRbvTjEIoTdUAUX3hcRkqvO6d_9sir-VPNucfrL-r_p4VAKB6Bd1vlsqrAMn-ofJT1dOZizXA_YtSADPU2Wt-cpCX0VbDsVOduHZFIsIDkR0h7QxKu7Nn5oOy4sYgT9G-K6CM7K4XlaChhUgAR-e7l8r8GFJw_YfCkqHULHL7KykQuJ_fUlSoXEOaSLMGS0wF89Z0n13lneAFtVN8V9m5z7u2-sDzmhn4rXc9UUpeCnoOh2U4YPamMejx1ydvq10qscQQ3vgW2N1VRk27kNMLh2J7_V4il0e5kSVhR6G4zW8957_YAtBu9QLYxvedhUAtJG7tpWIBz-6qfw0YN_eCMNoDaRbQ3YABSXbEwxl7FdrF4Bca4P5Km_zBBq9WuFcsv17JokWfYmFK0vDnSu_QR-3LHB5Ggf5iS_js8eQBRh0xLqG5CouoawoJiXPscCPRPxt0PPr8imBpPCAW_UJdAeX_4pddwG4EEANJQ0gZMv2V2ZGA52C6dUWUZenmZ7sbGSYge_8gaC_n0DKCOOy_8TR4LdAJbIcbJ2J065EacigKHnj1M-_fOggSI10LWeLYuz5S1ASDMtn4McQLEDnd11c_4I7ZkKRORg1wh8R0IA6ezUU7KupC-bAH_cdgeWFUHoOIoNBFL7lHca5bicxz0eAnLY5FTcHH3EJ43fziwhYFyF_36MaZAR2I9vF9v3CZd5cewTLgsMrGtFJYWH4zd4KfDB_Xb4fntlY3Dxdtw2tGDi7P0oxsZoIAdqqQIF81PZPnHP9mUT0gTC2nuvQDHwItjgeImRCtM7EsnI8j69smhidKxKcdjA9-fqIxXd55UseztBTL11KVYdOYBLDJDTLK9VSLWSjxq72-EasKRzsNZuApfa4TZRafZgzucJ5XRSChV4Zxr2btyn3kzCiKrLSYEDrsCf_Yb9oIj- -KUZdK7UzRd7tP_x_mMw3OV9dOFDzzlY4mxZ8Jk_s8XYTWpuSfDVofcYADvjvLsIouaI6wDmLyaAV2rXNZXt0iz5I_D3sIBYUO64Vbg6vphHGOzo9YOaaylJ4t5StaaNcG78_KbNl_g7lHOlbk5Xos8vw_0-iIurFuMD73A6dBUNqCv-PQF5kfat7qAp9SgwxGocZaxOA7u5hjlBlwuPPvbbhoVRv0pwVLriLFgwq7qaQCP6eTkFyCvH5OCvSwEqoXII6Ni45UKAjkDo9DGtK0uJSp1UEFzW0w8IMJv-4L6OJyJL6zHoyJK95dSImpTVY61XjNXMwWBv8Q-ucKPa7CwzAy4IfcJWheBbAeZVbL8pUA-L89tRt98xo7DooMYMle7AcMO1-iC3-rCDOBy4ZmaC3ym-EXU03MM58KnIjY60uJ04l8d__GQhbHPBkKTMrymnYXCK6aeeZVNw1RdCEHrLGnlOHKPXiz4SJEwfKDyaOP2ismymfIlkFaYjJuJEoV6zOTd6hKqB_rwX5mj3AI8PKvM6U0zZmOdbBsrZdJqtweMo7yeVO6t-Swx_0000]--></g></svg>rn_complete_responsibility_segregation.svg]()


### Core Components

### 1. Proxy Identity Provider

- Manages the relationship between users, agents, and MCP servers
- Provides enhanced consent flows that explicitly identify all entities involved in data access
- Maps proxy tokens to actual OAuth tokens while maintaining security boundaries

### 2. Gateway Service

- Enforces token validation and exchange mechanisms
- Prevents direct token passthrough by validating proxy tokens before accessing downstream services
- Implements comprehensive audit logging for all token exchanges

### 3. Session Management Layer

- Maintains secure linkage between application sessions, agent sessions, and MCP server sessions
- Implements non-deterministic session identifiers with proper binding to user-specific information
- Provides protection against session hijacking through cryptographic state validation

### Detailed Workflow

The solution implements a multi-stage authentication and authorization flow:

### Initial Setup (Steps 8.1-8.2)

- MCP Server identifies the need to access user data
- Gateway attempts data access and fails due to missing permissions, triggering the
authentication flow

### Discovery Phase (Steps 9-10)

- Gateway discovers the appropriate authorization server for the requested user data
- System prepares for dual-consent flow implementation

### Proxy Authentication Setup (Steps 14.1-14.2)

- MCP Server retrieves authentication delegation parameters
- Proxy Identity Provider configures parameters to route initial authentication through the
proxy layer

### User Consent Flow (Steps 17.1-24)

- Browser opens popup at Proxy Identity Provider's authorization endpoint
- **First Consent Screen**: User explicitly consents to data access by the complete entity
chain (Proxy, Agent, MCP Client, MCP Server, LLM)
- User is redirected to actual Authorization Server
- **Second Consent Screen**: User consents to proxy layer accessing their data (Authorization
Server remains unaware of underlying agent infrastructure)

### Code to Token Exchange (Steps 26-32)

- Proxy Identity Provider receives authorization code from actual Authorization Server
- System exchanges code for access token and creates corresponding proxy token mapping
- MCP Server obtains proxy access token (unaware of underlying token architecture)

### Secure Data Access (Steps 39-45)

- MCP Server selects appropriate proxy token based on maintained session context
- Gateway validates proxy token and exchanges for actual access token
- Data retrieval proceeds through validated token chain

### Agent Processing (Step 51)

- Agent receives context data and invokes LLM for output generation
- Complete audit trail maintained throughout the process

## Implementation Details

### Entity Relationship Management

### Agent-Client Relationships

- **Scope**: Lifecycle management for Agent-MCP Server relationships
- **Implementation**: Portal and API infrastructure for relationship registration and management
- **Responsibilities**: Integration with Proxy Authorization Servers and Identity Providers

### Agent-User Relationships

- **Scope**: Lifecycle management for User-{Agent, MCP Server} tuple relationships
- **Implementation**: User consent management portals and APIs
- **Responsibilities**: Ensuring explicit user consent for agent data access

### Agent-Client-User Relationships

- **Scope**: Consent lifecycle management for {User, Agent, MCP Server} tuples
- **Implementation**: Comprehensive consent applications and supporting APIs
- **Responsibilities**: Maintaining consent state across all entity relationships

### Security Architecture

### Tuple-Based Access Control

The Proxy system implements a tuple-based access model using `{User, Agent, MCP Server}` as the
fundamental access control unit:

- **Unique User Association**: Each tuple must include a user identifier to prevent cross-user
access violations
- **Consent Mapping**: One proxy access token maps to exactly one actual access token per tuple
- **Scalability**: Single actual access tokens may support multiple proxy tokens for different
tuple combinations

### Token Security

- **Proxy Token Isolation**: Proxy tokens never expose actual access tokens to agents or MCP servers
- **Validation Enforcement**: Gateway validates every proxy token before downstream access
- **Audit Compliance**: Complete token usage audit trails maintained for security and compliance

### Attack Mitigation Strategies

### Confused Deputy Protection

- **Universal Consent Verification**: Every data access request triggers consent validation for
the specific `{User, Agent, MCP Server}` tuple
- **Authentication Coupling**: Proxy consent acceptance is invalid without corresponding
successful authentication
- **Entity Registration**: All agents and MCP servers must be registered with established
relationships in the proxy layer

### Token Passthrough Prevention

- **Gateway Enforcement**: All data server interactions must include validated proxy and
actual tokens
- **Token Validation**: Invalid or missing proxy or actual tokens trigger user authentication flows
- **Access Control**: Direct access to actual access tokens is prevented through architectural
isolation

### Session Hijacking Mitigation

The solution addresses session security through comprehensive session linkage. The following is
an example of a potential solution:

1. **Application-Agent Session**: Application provides agent with ID token containing user
identifier and session ID
2. **Agent-MCP Client Session**: Agent passes session identifier to MCP client with proper
validation
3. **MCP Client-Server Session**: One-to-one mapping maintained between application session ID
and MCP session ID
4. **MCP Server-Proxy Session**: OAuth2 state field implemented as token containing MCP session ID
5. **Proxy-Identity Provider Session**: New OAuth2 state field preserves MCP server state while
maintaining proxy validation

### Session Security Requirements

- **Session Identifier Privacy**: Session IDs must remain private between involved parties or
require authenticated communication channels
- **Server Authentication**: Servers must authenticate all incoming communications and maintain
client-session mappings
- **State Token Security**: OAuth2 state values must be single-use with proper code_verifier
validation

## Deployment Considerations

### Integration Requirements

- **Identity Provider Compatibility**: Solution works with existing OAuth/OIDC providers without
requiring vendor modifications
- **Scalability**: Architecture supports multiple concurrent agent-user relationships
- **Audit Compliance**: Comprehensive logging and audit trail capabilities built into all components

### Security Best Practices

- **Least Privilege**: Agents receive minimal necessary permissions for specified tasks
- **Regular Token Rotation**: Implement automated token refresh and rotation policies
- **Monitoring and Alerting**: Real-time detection of anomalous access patterns or potential
security violations

## Conclusion

This solution provides a comprehensive approach to agent identity management that preserves the
security guarantees of existing OAuth/OIDC systems while extending them to support agentic
workflows. By implementing a proxy layer architecture with dual consent flows and comprehensive
session management, organizations can safely deploy AI agents with clear accountability chains
and robust security controls.

The architecture's compatibility with existing identity providers ensures immediate
implementability while providing a foundation for future enhancements as the agent ecosystem
continues to evolve.
